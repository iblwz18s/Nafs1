[
  {
    "path": "src/hooks/use-mobile.tsx",
    "content": "import * as React from \"react\";\n\nconst MOBILE_BREAKPOINT = 768;\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined);\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);\n    };\n    mql.addEventListener(\"change\", onChange);\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);\n    return () => mql.removeEventListener(\"change\", onChange);\n  }, []);\n\n  return !!isMobile;\n}\n"
  },
  {
    "path": "src/hooks/use-toast.ts",
    "content": "import * as React from \"react\";\n\nimport type { ToastActionElement, ToastProps } from \"@/components/ui/toast\";\n\nconst TOAST_LIMIT = 1;\nconst TOAST_REMOVE_DELAY = 1000000;\n\ntype ToasterToast = ToastProps & {\n  id: string;\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  action?: ToastActionElement;\n};\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const;\n\nlet count = 0;\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER;\n  return count.toString();\n}\n\ntype ActionType = typeof actionTypes;\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"];\n      toast: ToasterToast;\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"];\n      toast: Partial<ToasterToast>;\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"];\n      toastId?: ToasterToast[\"id\"];\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"];\n      toastId?: ToasterToast[\"id\"];\n    };\n\ninterface State {\n  toasts: ToasterToast[];\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return;\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId);\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    });\n  }, TOAST_REMOVE_DELAY);\n\n  toastTimeouts.set(toastId, timeout);\n};\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      };\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) => (t.id === action.toast.id ? { ...t, ...action.toast } : t)),\n      };\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action;\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId);\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id);\n        });\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t,\n        ),\n      };\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        };\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      };\n  }\n};\n\nconst listeners: Array<(state: State) => void> = [];\n\nlet memoryState: State = { toasts: [] };\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action);\n  listeners.forEach((listener) => {\n    listener(memoryState);\n  });\n}\n\ntype Toast = Omit<ToasterToast, \"id\">;\n\nfunction toast({ ...props }: Toast) {\n  const id = genId();\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    });\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id });\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss();\n      },\n    },\n  });\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  };\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState);\n\n  React.useEffect(() => {\n    listeners.push(setState);\n    return () => {\n      const index = listeners.indexOf(setState);\n      if (index > -1) {\n        listeners.splice(index, 1);\n      }\n    };\n  }, [state]);\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  };\n}\n\nexport { useToast, toast };\n"
  },
  {
    "path": "src/integrations/supabase/client.ts",
    "content": "// This file is automatically generated. Do not edit it directly.\nimport { createClient } from '@supabase/supabase-js';\nimport type { Database } from './types';\n\nconst SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;\nconst SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;\n\n// Import the supabase client like this:\n// import { supabase } from \"@/integrations/supabase/client\";\n\nexport const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {\n  auth: {\n    storage: localStorage,\n    persistSession: true,\n    autoRefreshToken: true,\n  }\n});"
  },
  {
    "path": "src/integrations/supabase/types.ts",
    "content": "export type Json =\n  | string\n  | number\n  | boolean\n  | null\n  | { [key: string]: Json | undefined }\n  | Json[]\n\nexport type Database = {\n  // Allows to automatically instantiate createClient with right options\n  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)\n  __InternalSupabase: {\n    PostgrestVersion: \"14.1\"\n  }\n  public: {\n    Tables: {\n      student_progress: {\n        Row: {\n          completed_at: string | null\n          id: string\n          score: number\n          standard_id: string\n          student_id: string\n          sub_indicator_id: string\n          total_questions: number\n        }\n        Insert: {\n          completed_at?: string | null\n          id?: string\n          score: number\n          standard_id: string\n          student_id: string\n          sub_indicator_id: string\n          total_questions: number\n        }\n        Update: {\n          completed_at?: string | null\n          id?: string\n          score?: number\n          standard_id?: string\n          student_id?: string\n          sub_indicator_id?: string\n          total_questions?: number\n        }\n        Relationships: [\n          {\n            foreignKeyName: \"student_progress_student_id_fkey\"\n            columns: [\"student_id\"]\n            isOneToOne: false\n            referencedRelation: \"students\"\n            referencedColumns: [\"id\"]\n          },\n        ]\n      }\n      students: {\n        Row: {\n          created_at: string | null\n          grade: string\n          id: string\n          parent_name: string\n          phone_number: string\n          pin_code: string\n          student_name: string\n        }\n        Insert: {\n          created_at?: string | null\n          grade: string\n          id?: string\n          parent_name: string\n          phone_number: string\n          pin_code: string\n          student_name: string\n        }\n        Update: {\n          created_at?: string | null\n          grade?: string\n          id?: string\n          parent_name?: string\n          phone_number?: string\n          pin_code?: string\n          student_name?: string\n        }\n        Relationships: []\n      }\n      training_images: {\n        Row: {\n          created_at: string\n          file_name: string\n          file_path: string\n          id: string\n          uploaded_by: string | null\n        }\n        Insert: {\n          created_at?: string\n          file_name: string\n          file_path: string\n          id?: string\n          uploaded_by?: string | null\n        }\n        Update: {\n          created_at?: string\n          file_name?: string\n          file_path?: string\n          id?: string\n          uploaded_by?: string | null\n        }\n        Relationships: []\n      }\n      user_roles: {\n        Row: {\n          created_at: string\n          id: string\n          role: Database[\"public\"][\"Enums\"][\"app_role\"]\n          user_id: string\n        }\n        Insert: {\n          created_at?: string\n          id?: string\n          role: Database[\"public\"][\"Enums\"][\"app_role\"]\n          user_id: string\n        }\n        Update: {\n          created_at?: string\n          id?: string\n          role?: Database[\"public\"][\"Enums\"][\"app_role\"]\n          user_id?: string\n        }\n        Relationships: []\n      }\n    }\n    Views: {\n      [_ in never]: never\n    }\n    Functions: {\n      has_role: {\n        Args: {\n          _role: Database[\"public\"][\"Enums\"][\"app_role\"]\n          _user_id: string\n        }\n        Returns: boolean\n      }\n    }\n    Enums: {\n      app_role: \"admin\" | \"user\"\n    }\n    CompositeTypes: {\n      [_ in never]: never\n    }\n  }\n}\n\ntype DatabaseWithoutInternals = Omit<Database, \"__InternalSupabase\">\n\ntype DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, \"public\">]\n\nexport type Tables<\n  DefaultSchemaTableNameOrOptions extends\n    | keyof (DefaultSchema[\"Tables\"] & DefaultSchema[\"Views\"])\n    | { schema: keyof DatabaseWithoutInternals },\n  TableName extends DefaultSchemaTableNameOrOptions extends {\n    schema: keyof DatabaseWithoutInternals\n  }\n    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Tables\"] &\n        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Views\"])\n    : never = never,\n> = DefaultSchemaTableNameOrOptions extends {\n  schema: keyof DatabaseWithoutInternals\n}\n  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Tables\"] &\n      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Views\"])[TableName] extends {\n      Row: infer R\n    }\n    ? R\n    : never\n  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema[\"Tables\"] &\n        DefaultSchema[\"Views\"])\n    ? (DefaultSchema[\"Tables\"] &\n        DefaultSchema[\"Views\"])[DefaultSchemaTableNameOrOptions] extends {\n        Row: infer R\n      }\n      ? R\n      : never\n    : never\n\nexport type TablesInsert<\n  DefaultSchemaTableNameOrOptions extends\n    | keyof DefaultSchema[\"Tables\"]\n    | { schema: keyof DatabaseWithoutInternals },\n  TableName extends DefaultSchemaTableNameOrOptions extends {\n    schema: keyof DatabaseWithoutInternals\n  }\n    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Tables\"]\n    : never = never,\n> = DefaultSchemaTableNameOrOptions extends {\n  schema: keyof DatabaseWithoutInternals\n}\n  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Tables\"][TableName] extends {\n      Insert: infer I\n    }\n    ? I\n    : never\n  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema[\"Tables\"]\n    ? DefaultSchema[\"Tables\"][DefaultSchemaTableNameOrOptions] extends {\n        Insert: infer I\n      }\n      ? I\n      : never\n    : never\n\nexport type TablesUpdate<\n  DefaultSchemaTableNameOrOptions extends\n    | keyof DefaultSchema[\"Tables\"]\n    | { schema: keyof DatabaseWithoutInternals },\n  TableName extends DefaultSchemaTableNameOrOptions extends {\n    schema: keyof DatabaseWithoutInternals\n  }\n    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Tables\"]\n    : never = never,\n> = DefaultSchemaTableNameOrOptions extends {\n  schema: keyof DatabaseWithoutInternals\n}\n  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions[\"schema\"]][\"Tables\"][TableName] extends {\n      Update: infer U\n    }\n    ? U\n    : never\n  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema[\"Tables\"]\n    ? DefaultSchema[\"Tables\"][DefaultSchemaTableNameOrOptions] extends {\n        Update: infer U\n      }\n      ? U\n      : never\n    : never\n\nexport type Enums<\n  DefaultSchemaEnumNameOrOptions extends\n    | keyof DefaultSchema[\"Enums\"]\n    | { schema: keyof DatabaseWithoutInternals },\n  EnumName extends DefaultSchemaEnumNameOrOptions extends {\n    schema: keyof DatabaseWithoutInternals\n  }\n    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions[\"schema\"]][\"Enums\"]\n    : never = never,\n> = DefaultSchemaEnumNameOrOptions extends {\n  schema: keyof DatabaseWithoutInternals\n}\n  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions[\"schema\"]][\"Enums\"][EnumName]\n  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema[\"Enums\"]\n    ? DefaultSchema[\"Enums\"][DefaultSchemaEnumNameOrOptions]\n    : never\n\nexport type CompositeTypes<\n  PublicCompositeTypeNameOrOptions extends\n    | keyof DefaultSchema[\"CompositeTypes\"]\n    | { schema: keyof DatabaseWithoutInternals },\n  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {\n    schema: keyof DatabaseWithoutInternals\n  }\n    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions[\"schema\"]][\"CompositeTypes\"]\n    : never = never,\n> = PublicCompositeTypeNameOrOptions extends {\n  schema: keyof DatabaseWithoutInternals\n}\n  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions[\"schema\"]][\"CompositeTypes\"][CompositeTypeName]\n  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema[\"CompositeTypes\"]\n    ? DefaultSchema[\"CompositeTypes\"][PublicCompositeTypeNameOrOptions]\n    : never\n\nexport const Constants = {\n  public: {\n    Enums: {\n      app_role: [\"admin\", \"user\"],\n    },\n  },\n} as const\n"
  },
  {
    "path": "src/lib/utils.ts",
    "content": "import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"
  },
  {
    "path": "src/pages/Index.tsx",
    "content": "import { useState, useEffect } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport Header from \"@/components/Header\";\nimport GradeCard from \"@/components/GradeCard\";\nimport SubjectCard from \"@/components/SubjectCard\";\nimport StandardCard from \"@/components/StandardCard\";\nimport Grade6StandardsView from \"@/components/Grade6StandardsView\";\nimport TeacherSelector from \"@/components/TeacherSelector\";\nimport StudentSelector from \"@/components/StudentSelector\";\nimport ParentLogin from \"@/components/ParentLogin\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { grades, getSubjectsByGrade, getStandardsBySubject, getGradeById, getSubjectById } from \"@/data/standards\";\nimport { ArrowRight } from \"lucide-react\";\nimport logo from \"@/assets/logo.png\";\nimport trainingIcon from \"@/assets/training-icon.gif\";\nimport familyIcon from \"@/assets/family-icon.png\";\n\nimport { teacherData } from \"@/data/classData\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\ntype NavigationState = {\n  selectedGrade: string | null;\n  selectedSubject: string | null;\n  selectedTeacher: boolean;\n  selectedStudent: string | null;\n  userType: \"teacher\" | \"parent\" | null;\n};\n\nconst Index = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const restoreState = (location.state ?? null) as Partial<NavigationState> | null;\n\n  const [selectedGrade, setSelectedGrade] = useState<string | null>(restoreState?.selectedGrade ?? null);\n  const [selectedSubject, setSelectedSubject] = useState<string | null>(restoreState?.selectedSubject ?? null);\n  const [selectedTeacher, setSelectedTeacher] = useState<boolean>(restoreState?.selectedTeacher ?? false);\n  const [selectedStudent, setSelectedStudent] = useState<string | null>(restoreState?.selectedStudent ?? null);\n  const [userType, setUserType] = useState<\"teacher\" | \"parent\" | null>(restoreState?.userType ?? null);\n\n  const subjects = selectedGrade ? getSubjectsByGrade(selectedGrade) : [];\n  const standards = selectedSubject ? getStandardsBySubject(selectedSubject) : [];\n  const currentGrade = selectedGrade ? getGradeById(selectedGrade) : null;\n  const currentSubject = selectedSubject ? getSubjectById(selectedSubject) : null;\n\n  // Check if this grade+subject has teacher/student selection\n  const hasClassData = selectedSubject ? !!teacherData[selectedSubject] : false;\n  const teacher = hasClassData && selectedSubject ? teacherData[selectedSubject] : null;\n\n  // Fetch students from Supabase based on selected grade\n  const [classStudents, setClassStudents] = useState<string[]>([]);\n  \n  const normalizeGrade = (grade: string) => {\n    if (grade.startsWith(\"grade-\")) return grade.replace(\"grade-\", \"\");\n    return grade;\n  };\n\n  useEffect(() => {\n    if (selectedSubject && hasClassData && selectedGrade) {\n      const fetchStudents = async () => {\n        const gradeNumber = normalizeGrade(selectedGrade);\n        const { data, error } = await supabase\n          .from(\"students\")\n          .select(\"student_name, grade\")\n          .order(\"student_name\");\n        \n        if (!error && data) {\n          const filteredStudents = data\n            .filter(s => normalizeGrade(s.grade) === gradeNumber)\n            .map(s => s.student_name);\n          setClassStudents(filteredStudents);\n        }\n      };\n      fetchStudents();\n    }\n  }, [selectedSubject, hasClassData, selectedGrade]);\n\n  const handleBack = () => {\n    if (userType === \"parent\" && selectedStudent) {\n      setSelectedStudent(null);\n    } else if (userType === \"parent\") {\n      setUserType(null);\n    } else if (hasClassData && selectedStudent) {\n      setSelectedStudent(null);\n    } else if (hasClassData && selectedTeacher) {\n      setSelectedTeacher(false);\n    } else if (selectedSubject) {\n      setSelectedSubject(null);\n      setSelectedTeacher(false);\n      setSelectedStudent(null);\n    } else if (userType) {\n      setUserType(null);\n    } else if (selectedGrade) {\n      setSelectedGrade(null);\n      setUserType(null);\n    }\n  };\n\n  const handleStartQuiz = (standardId: string, subIndicatorId?: string) => {\n    const navigationState: NavigationState = {\n      selectedGrade,\n      selectedSubject,\n      selectedTeacher,\n      selectedStudent,\n      userType,\n    };\n\n    if (subIndicatorId) {\n      navigate(`/quiz/${standardId}?subIndicator=${subIndicatorId}`, { state: navigationState });\n    } else {\n      navigate(`/quiz/${standardId}`, { state: navigationState });\n    }\n  };\n\n  // التحقق مما إذا كان الموضوع يحتاج عرض خاص (لغتي أو الرياضيات أو العلوم للصف السادس | رياضيات ولغتي الصف الثالث)\n  const isGrade6Arabic = selectedSubject === \"reading-6\";\n  const isGrade6Math = selectedSubject === \"math-6\";\n  const isGrade6Science = selectedSubject === \"science-6\";\n  const isGrade3Math = selectedSubject === \"math-3\";\n  const isGrade3Arabic = selectedSubject === \"reading-3\";\n  const showCollapsibleView = isGrade6Arabic || isGrade6Math || isGrade6Science || isGrade3Math || isGrade3Arabic;\n\n  return (\n    <div \n      className=\"min-h-screen bg-background bg-cover bg-center bg-no-repeat bg-fixed\"\n      style={{ backgroundImage: \"url('/images/nafs-background.jpeg')\" }}\n    >\n      {/* طبقة شفافة لتحسين قراءة المحتوى */}\n      <div className=\"min-h-screen bg-background/85 dark:bg-background/90\">\n      <Header />\n      \n      <main className=\"container mx-auto px-4 py-8\">\n        {/* مسار التنقل */}\n        {(selectedGrade || selectedSubject) && (\n          <div className=\"mb-6 flex items-center gap-2\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={handleBack} className=\"text-muted-foreground hover:text-foreground\">\n              <ArrowRight className=\"w-4 h-4 ml-1\" />\n              رجوع\n            </Button>\n            <span className=\"text-muted-foreground\">/</span>\n            {currentGrade && <span className=\"text-foreground font-medium\">{currentGrade.name}</span>}\n            {currentSubject && (\n              <>\n                <span className=\"text-muted-foreground\">/</span>\n                <span className=\"text-foreground font-medium\">{currentSubject.name}</span>\n              </>\n            )}\n          </div>\n        )}\n\n        {/* اختيار الصف */}\n        {!selectedGrade && (\n          <div className=\"animate-fade-in\">\n            <div className=\"text-center mb-6 md:mb-10\">\n              <img src={logo} alt=\"شعار وزارة التعليم\" className=\"h-40 md:h-56 lg:h-64 mx-auto mb-3 md:mb-4\" />\n              <h1 className=\"text-xl md:text-3xl font-bold text-primary mb-3 md:mb-6\">اختبارات محاكاة نافس 2026</h1>\n              <h2 className=\"text-2xl md:text-3xl font-bold text-foreground mb-2 md:mb-3\">اختر الصف الدراسي</h2>\n              <p className=\"text-muted-foreground text-sm md:text-base\">حدد الصف لبدء الاختبارات المحاكية.</p>\n            </div>\n            <div className=\"grid grid-cols-2 gap-3 md:gap-6 max-w-2xl mx-auto\">\n              {grades.map((grade) => (\n                <GradeCard\n                  key={grade.id}\n                  grade={grade}\n                  onClick={() => setSelectedGrade(grade.id)}\n                />\n              ))}\n            </div>\n            \n            {/* زر شواهد التدريب */}\n            <div className=\"mt-8 text-center\">\n              <Button \n                variant=\"outline\" \n                size=\"lg\"\n                onClick={() => navigate(\"/training-gallery\")}\n                className=\"border-primary/50 hover:border-primary hover:bg-primary/10 gap-2\"\n              >\n                <img src={trainingIcon} alt=\"\" className=\"w-6 h-6 object-contain\" />\n                شواهد التدريب\n              </Button>\n            </div>\n\n          </div>\n        )}\n\n        {/* اختيار نوع المستخدم (طالب أو ولي أمر) */}\n        {selectedGrade && !userType && (\n          <div className=\"animate-fade-in\">\n            <div className=\"text-center mb-10\">\n              <h2 className=\"text-3xl font-bold text-foreground mb-3\">نوع الدخول</h2>\n              <p className=\"text-muted-foreground\">{currentGrade?.name}</p>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto\">\n              <Card \n                className=\"cursor-pointer card-hover border-2 border-border hover:border-primary bg-card\"\n                onClick={() => setUserType(\"teacher\")}\n              >\n                <CardContent className=\"p-8 text-center\">\n                  <div className=\"w-20 h-20 mx-auto mb-4 flex items-center justify-center\">\n                    <img src={trainingIcon} alt=\"معلم\" className=\"w-16 h-16 object-contain\" />\n                  </div>\n                  <h3 className=\"text-xl font-bold text-foreground mb-2\">معلم</h3>\n                  <p className=\"text-muted-foreground text-sm\">التدريب على الاختبارات</p>\n                </CardContent>\n              </Card>\n\n              <Card \n                className=\"cursor-pointer card-hover border-2 border-border hover:border-secondary bg-card\"\n                onClick={() => setUserType(\"parent\")}\n              >\n                <CardContent className=\"p-8 text-center\">\n                  <div className=\"w-20 h-20 mx-auto mb-4 flex items-center justify-center\">\n                    <img src={familyIcon} alt=\"ولي أمر\" className=\"w-16 h-16 object-contain\" />\n                  </div>\n                  <h3 className=\"text-xl font-bold text-foreground mb-2\">ولي أمر</h3>\n                  <p className=\"text-muted-foreground text-sm\">اختبار الطالب وحفظ تقدمه</p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        )}\n\n        {/* دخول ولي الأمر */}\n        {selectedGrade && userType === \"parent\" && !selectedStudent && (\n          <ParentLogin\n            grade={selectedGrade}\n            gradeName={currentGrade?.name || \"\"}\n            onBack={() => setUserType(null)}\n            onSuccess={(student) => setSelectedStudent(student)}\n          />\n        )}\n\n        {/* اختيار المادة - للمعلم أو ولي الأمر بعد اختيار الطالب */}\n        {selectedGrade && ((userType === \"teacher\") || (userType === \"parent\" && selectedStudent)) && !selectedSubject && (\n          <div className=\"animate-fade-in\">\n            <div className=\"text-center mb-10\">\n              {userType === \"parent\" && selectedStudent && (\n                <div className=\"mb-4 bg-primary/10 rounded-lg p-3 inline-block\">\n                  <p className=\"text-muted-foreground text-sm\">الطالب:</p>\n                  <p className=\"text-primary font-bold\">{selectedStudent}</p>\n                </div>\n              )}\n              <h2 className=\"text-3xl font-bold text-foreground mb-3\">اختر المادة</h2>\n              <p className=\"text-muted-foreground\">{currentGrade?.name}</p>\n            </div>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-6 max-w-3xl mx-auto\">\n              {subjects.map((subject) => (\n                <SubjectCard\n                  key={subject.id}\n                  subject={subject}\n                  onClick={() => setSelectedSubject(subject.id)}\n                />\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* اختيار المعلم - فقط للصف الثالث رياضيات */}\n        {selectedSubject && hasClassData && !selectedTeacher && (\n          <TeacherSelector \n            teacherName={teacher!.name}\n            teacherSubject={teacher!.subject}\n            onSelect={() => setSelectedTeacher(true)} \n          />\n        )}\n\n        {/* اختيار الطالب */}\n        {selectedSubject && hasClassData && selectedTeacher && !selectedStudent && classStudents.length > 0 && (\n          <StudentSelector \n            students={classStudents} \n            onSelect={(student) => setSelectedStudent(student)} \n          />\n        )}\n\n        {/* عرض المعايير */}\n        {selectedSubject && (!hasClassData || (selectedTeacher && selectedStudent)) && (\n          <div className=\"animate-fade-in\">\n            <div className=\"text-center mb-10\">\n              {selectedStudent && (\n                <div className=\"mb-4 bg-primary/10 rounded-lg p-3 inline-block\">\n                  <p className=\"text-muted-foreground text-sm\">الطالب:</p>\n                  <p className=\"text-primary font-bold\">{selectedStudent}</p>\n                </div>\n              )}\n              <h2 className=\"text-3xl font-bold text-foreground mb-3\">معايير {currentSubject?.name}</h2>\n              <p className=\"text-muted-foreground\">اختر المعيار لبدء الاختبار</p>\n            </div>\n            \n            {/* عرض خاص لمعايير لغتي والرياضيات للصف السادس مع المؤشرات الفرعية */}\n            {showCollapsibleView ? (\n              <div className=\"max-w-3xl mx-auto\">\n                <Grade6StandardsView \n                  standards={standards} \n                  onStartQuiz={handleStartQuiz}\n                />\n              </div>\n            ) : (\n              <div className=\"grid gap-4 max-w-3xl mx-auto\">\n                {standards.map((standard, index) => (\n                  <StandardCard\n                    key={standard.id}\n                    standard={standard}\n                    index={index}\n                    onClick={() => handleStartQuiz(standard.id)}\n                  />\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n      </main>\n\n      <footer className=\"py-6 text-center text-muted-foreground border-t border-border/50 mt-12\">\n        <p>ابتدائية سعد بن أبي وقاص © {new Date().getFullYear()}</p>\n      </footer>\n      </div>\n    </div>\n  );\n};\n\nexport default Index;\n"
  },
  {
    "path": "src/pages/NotFound.tsx",
    "content": "import { useLocation } from \"react-router-dom\";\nimport { useEffect } from \"react\";\n\nconst NotFound = () => {\n  const location = useLocation();\n\n  useEffect(() => {\n    console.error(\"404 Error: User attempted to access non-existent route:\", location.pathname);\n  }, [location.pathname]);\n\n  return (\n    <div className=\"flex min-h-screen items-center justify-center bg-muted\">\n      <div className=\"text-center\">\n        <h1 className=\"mb-4 text-4xl font-bold\">404</h1>\n        <p className=\"mb-4 text-xl text-muted-foreground\">Oops! Page not found</p>\n        <a href=\"/\" className=\"text-primary underline hover:text-primary/90\">\n          Return to Home\n        </a>\n      </div>\n    </div>\n  );\n};\n\nexport default NotFound;\n"
  },
  {
    "path": "src/pages/Quiz.tsx",
    "content": "import { useState, useRef, useMemo } from \"react\";\nimport { useParams, useNavigate, useSearchParams, useLocation } from \"react-router-dom\";\nimport Header from \"@/components/Header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { getStandardById, getSubIndicatorById } from \"@/data/standards\";\nimport { getQuestionsByStandard, getQuestionsBySubIndicator, Question, passages } from \"@/data/questions\";\nimport { ArrowRight, CheckCircle2, XCircle, Check, X, Lightbulb, Printer, FileText, SkipForward, BookOpen, ChevronDown, ChevronUp } from \"lucide-react\";\nimport SuccessResult from \"@/components/ui/success-result\";\n\n// دالة لتوليد شرح تفصيلي للإجابة\nconst generateDetailedExplanation = (question: Question, userAnswer: number): string => {\n  const correctOption = question.options[question.correctAnswer];\n  const userOption = question.options[userAnswer];\n  const arabicLetters = [\"أ\", \"ب\", \"ج\", \"د\"];\n  const isCorrect = userAnswer === question.correctAnswer;\n  \n  // تحليل نوع السؤال وتقديم شرح مفصل\n  \n  // أسئلة المرادفات والأضداد\n  if (question.text.includes(\"مرادف\")) {\n    const word = question.text.match(/كلمة\\s*\"([^\"]+)\"/)?.[1] || \"\";\n    if (isCorrect) {\n      return `أحسنت! \"${correctOption}\" هي المرادف الصحيح لكلمة \"${word}\". كلتا الكلمتين تحملان نفس المعنى ويمكن استخدامهما في نفس السياق.`;\n    }\n    return `الإجابة الصحيحة هي \"${correctOption}\" وليس \"${userOption}\". المرادف يعني الكلمة التي تحمل نفس المعنى. فكلمة \"${word}\" تعني \"${correctOption}\"، بينما \"${userOption}\" لها معنى مختلف.`;\n  }\n  \n  if (question.text.includes(\"ضد\")) {\n    const word = question.text.match(/كلمة\\s*\"([^\"]+)\"/)?.[1] || \"\";\n    if (isCorrect) {\n      return `ممتاز! \"${correctOption}\" هي الكلمة المضادة لـ \"${word}\". الضد يعني الكلمة التي تحمل معنى عكسي تماماً.`;\n    }\n    return `الإجابة الصحيحة هي \"${correctOption}\". ضد الكلمة يعني عكسها في المعنى. فضد \"${word}\" هو \"${correctOption}\" لأنهما يحملان معنيين متعاكسين تماماً.`;\n  }\n\n  // أسئلة الجمع والمفرد\n  if (question.text.includes(\"الجمع\") || question.text.includes(\"جمع\")) {\n    if (isCorrect) {\n      return `صحيح! \"${correctOption}\" هي صيغة الجمع لأنها تدل على أكثر من اثنين. علامات الجمع: ـون، ـين للمذكر السالم، ـات للمؤنث السالم، أو تغيير في بنية الكلمة لجمع التكسير.`;\n    }\n    return `الإجابة الصحيحة هي \"${correctOption}\". الجمع يدل على أكثر من اثنين. \"${userOption}\" ليست جمعاً لأنها تدل على مفرد أو مثنى.`;\n  }\n\n  // أسئلة القيمة المنزلية\n  if (question.text.includes(\"القيمة المنزلية\")) {\n    const number = question.text.match(/العدد\\s*(\\d+)/)?.[1] || \"\";\n    const digit = question.text.match(/الرقم\\s*(\\d)/)?.[1] || \"\";\n    if (isCorrect) {\n      return `ممتاز! في العدد ${number}، الرقم ${digit} يقع في منزلة ${correctOption}. المنازل من اليمين: آحاد، عشرات، مئات، ألوف، عشرات الألوف.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. لتحديد القيمة المنزلية، عد المنازل من اليمين: المنزلة الأولى آحاد، الثانية عشرات، الثالثة مئات، الرابعة ألوف. في العدد ${number}، الرقم ${digit} يقع في منزلة ${correctOption}.`;\n  }\n\n  // أسئلة العمليات الحسابية\n  if (question.text.includes(\"ناتج\") || question.text.includes(\"=\")) {\n    if (question.text.includes(\"+\")) {\n      if (isCorrect) {\n        return `أحسنت! الناتج ${correctOption} صحيح. للتحقق: اجمع الأرقام من اليمين (الآحاد) أولاً، ثم العشرات، ثم المئات مع مراعاة الحمل إذا تجاوز الناتج 9.`;\n      }\n      return `الإجابة الصحيحة هي ${correctOption}. عند الجمع، ابدأ من الآحاد وانتقل يساراً. إذا تجاوز الناتج 9، احمل 1 للمنزلة التالية.`;\n    }\n    if (question.text.includes(\"-\")) {\n      if (isCorrect) {\n        return `ممتاز! الناتج ${correctOption} صحيح. للتحقق: اطرح الأرقام من اليمين مع الاستلاف من المنزلة الأعلى عند الحاجة.`;\n      }\n      return `الإجابة الصحيحة هي ${correctOption}. عند الطرح، ابدأ من الآحاد. إذا كان الرقم العلوي أصغر، استلف 1 من المنزلة التالية (تصبح 10).`;\n    }\n    if (question.text.includes(\"×\") || question.text.includes(\"*\")) {\n      if (isCorrect) {\n        return `رائع! ${correctOption} هو الناتج الصحيح. الضرب هو جمع متكرر، مثلاً 4 × 5 يعني جمع 5 أربع مرات.`;\n      }\n      return `الإجابة الصحيحة هي ${correctOption}. تذكر جدول الضرب، أو استخدم الجمع المتكرر للتحقق.`;\n    }\n    if (question.text.includes(\"÷\")) {\n      if (isCorrect) {\n        return `أحسنت! الناتج ${correctOption} صحيح. القسمة هي عكس الضرب، أي توزيع العدد بالتساوي.`;\n      }\n      return `الإجابة الصحيحة هي ${correctOption}. القسمة تعني التوزيع المتساوي. للتحقق: اضرب الناتج في المقسوم عليه، يجب أن يساوي المقسوم.`;\n    }\n  }\n\n  // أسئلة الكسور\n  if (question.text.includes(\"كسر\") || question.text.includes(\"كسور\")) {\n    if (question.text.includes(\"يكافئ\") || question.text.includes(\"متكافئ\")) {\n      if (isCorrect) {\n        return `صحيح! الكسران متكافئان لأن لهما نفس القيمة. للتحقق: اضرب أو اقسم البسط والمقام بنفس العدد.`;\n      }\n      return `الإجابة الصحيحة هي ${correctOption}. الكسور المتكافئة لها نفس القيمة. مثلاً 1/2 = 2/4 لأننا ضربنا البسط والمقام في 2.`;\n    }\n    if (question.text.includes(\"أكبر\") || question.text.includes(\"أصغر\")) {\n      if (isCorrect) {\n        return `ممتاز! عند مقارنة الكسور بنفس المقام، الكسر ذو البسط الأكبر هو الأكبر. وعند تساوي البسط، الكسر ذو المقام الأصغر هو الأكبر.`;\n      }\n      return `الإجابة الصحيحة هي ${correctOption}. لمقارنة الكسور: إذا تساوت المقامات، قارن البسط. إذا تساوت البسوط، الكسر ذو المقام الأصغر أكبر (1/2 > 1/3).`;\n    }\n  }\n\n  // أسئلة المحيط والمساحة\n  if (question.text.includes(\"محيط\")) {\n    if (isCorrect) {\n      return `أحسنت! المحيط = مجموع أطوال جميع الأضلاع. للمربع: المحيط = 4 × طول الضلع. للمستطيل: المحيط = 2 × (الطول + العرض).`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. المحيط هو مجموع أطوال جميع الأضلاع. راجع الأبعاد المعطاة واجمعها.`;\n  }\n\n  if (question.text.includes(\"مساحة\")) {\n    if (isCorrect) {\n      return `ممتاز! مساحة المربع = الضلع × الضلع. مساحة المستطيل = الطول × العرض. المساحة تقاس بالوحدات المربعة.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. لحساب المساحة: المربع = الضلع²، المستطيل = الطول × العرض. راجع الأبعاد المعطاة.`;\n  }\n\n  // أسئلة الوقت\n  if (question.text.includes(\"ساعة\") || question.text.includes(\"دقيقة\") || question.text.includes(\"الوقت\")) {\n    if (isCorrect) {\n      return `صحيح! تذكر: الساعة = 60 دقيقة، نصف ساعة = 30 دقيقة، ربع ساعة = 15 دقيقة. اليوم = 24 ساعة.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. الساعة = 60 دقيقة. لحساب الوقت، حول جميع القيم لنفس الوحدة (دقائق) ثم أجرِ العملية.`;\n  }\n\n  // أسئلة القياس\n  if (question.text.includes(\"لتر\") || question.text.includes(\"مليلتر\")) {\n    if (isCorrect) {\n      return `أحسنت! 1 لتر = 1000 مليلتر. للتحويل من لتر إلى مليلتر اضرب في 1000، والعكس اقسم على 1000.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. تذكر: 1 لتر = 1000 مليلتر. استخدم هذه العلاقة في التحويل.`;\n  }\n\n  if (question.text.includes(\"كيلو\") || question.text.includes(\"جرام\")) {\n    if (isCorrect) {\n      return `ممتاز! 1 كيلوجرام = 1000 جرام. للتحويل من كيلو إلى جرام اضرب في 1000.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. تذكر: 1 كيلوجرام = 1000 جرام. استخدم هذه العلاقة في الحل.`;\n  }\n\n  if (question.text.includes(\"سنتمتر\") || question.text.includes(\"متر\")) {\n    if (isCorrect) {\n      return `صحيح! 1 متر = 100 سنتمتر. للتحويل من متر إلى سنتمتر اضرب في 100.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. تذكر: 1 متر = 100 سنتمتر. استخدم هذه العلاقة في التحويل.`;\n  }\n\n  // أسئلة النقود\n  if (question.text.includes(\"ريال\") || question.text.includes(\"نقود\") || question.text.includes(\"مبلغ\")) {\n    if (isCorrect) {\n      return `أحسنت! في المسائل المالية، استخدم الجمع لحساب المجموع والطرح لحساب الباقي أو الفرق.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. اقرأ المسألة بتمعن: هل المطلوب المجموع (جمع) أم الباقي (طرح) أم الفرق؟`;\n  }\n\n  // أسئلة الزوايا\n  if (question.text.includes(\"زاوية\") || question.text.includes(\"زوايا\")) {\n    if (isCorrect) {\n      return `ممتاز! الزاوية القائمة = 90°، الزاوية الحادة < 90°، الزاوية المنفرجة > 90° و < 180°، الزاوية المستقيمة = 180°.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. أنواع الزوايا: القائمة = 90°، الحادة أقل من 90°، المنفرجة بين 90° و 180°.`;\n  }\n\n  // أسئلة النسبة المئوية\n  if (question.text.includes(\"نسبة\") || question.text.includes(\"%\")) {\n    if (isCorrect) {\n      return `أحسنت! النسبة المئوية = (الجزء ÷ الكل) × 100. مثلاً: 25% تعني 25 من كل 100، أي ربع الكمية.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. لحساب النسبة المئوية: اقسم الجزء على الكل واضرب في 100.`;\n  }\n\n  // أسئلة الأنماط\n  if (question.text.includes(\"نمط\") || question.text.includes(\"النمط\") || question.text.includes(\"التسلسل\")) {\n    if (isCorrect) {\n      return `ممتاز! لإيجاد النمط، ابحث عن العلاقة بين الأعداد المتتالية (جمع، طرح، ضرب، أو قسمة بقيمة ثابتة).`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. لإيجاد النمط: احسب الفرق أو النسبة بين كل عددين متتاليين لاكتشاف القاعدة.`;\n  }\n\n  // أسئلة الترتيب\n  if (question.text.includes(\"رتب\") || question.text.includes(\"تصاعدي\") || question.text.includes(\"تنازلي\")) {\n    if (isCorrect) {\n      return `صحيح! الترتيب التصاعدي من الأصغر للأكبر، والتنازلي من الأكبر للأصغر. قارن الأرقام منزلة بمنزلة من اليسار.`;\n    }\n    return `الإجابة الصحيحة هي ${correctOption}. للترتيب: قارن عدد المنازل أولاً، ثم قارن الأرقام من اليسار.`;\n  }\n\n  // أسئلة الأفكار الصريحة\n  if (question.text.includes(\"متى\") || question.text.includes(\"أين\") || question.text.includes(\"من\") || question.text.includes(\"ماذا\") || question.text.includes(\"كم\")) {\n    if (isCorrect) {\n      return `أحسنت! لقد استخرجت المعلومة الصحيحة من النص. دائماً ابحث عن الكلمات المفتاحية التي تجيب على السؤال مباشرة.`;\n    }\n    return `الإجابة الصحيحة هي \"${correctOption}\". اقرأ النص بعناية وابحث عن الكلمة أو العبارة التي تجيب مباشرة على السؤال المطروح.`;\n  }\n\n  // أسئلة التعبير الجمالي والحقيقة والرأي\n  if (question.text.includes(\"تعبير جمالي\") || question.text.includes(\"تشبيه\") || question.text.includes(\"مجاز\")) {\n    if (isCorrect) {\n      return `ممتاز! التعبير الجمالي يستخدم الصور والتشبيهات لتجميل المعنى، مثل: \"القمر مصباح الليل\" يشبه القمر بالمصباح.`;\n    }\n    return `الإجابة الصحيحة هي \"${correctOption}\". التعبير الجمالي يتضمن تشبيهات واستعارات تُجمّل المعنى وتثري اللغة.`;\n  }\n\n  if (question.text.includes(\"حقيقة\") || question.text.includes(\"رأي\")) {\n    if (isCorrect) {\n      return `صحيح! الحقيقة يمكن إثباتها ولا تختلف من شخص لآخر، أما الرأي فهو وجهة نظر شخصية قد تختلف.`;\n    }\n    return `الإجابة الصحيحة هي \"${correctOption}\". الحقيقة ثابتة ويمكن التحقق منها، أما الرأي فيبدأ غالباً بـ \"أعتقد\" أو \"في رأيي\" ويختلف من شخص لآخر.`;\n  }\n\n  // شرح عام محسّن\n  if (isCorrect) {\n    return `إجابة صحيحة! \"${correctOption}\" هي الإجابة الصحيحة. استمر في التركيز وقراءة الأسئلة بعناية.`;\n  }\n  return `الإجابة الصحيحة هي (${arabicLetters[question.correctAnswer]}) \"${correctOption}\" وليس \"${userOption}\". راجع المفهوم المتعلق بهذا السؤال وحاول فهم الفرق بين الخيارات.`;\n};\n\ninterface QuestionResult {\n  question: Question;\n  userAnswer: number;\n  isCorrect: boolean;\n}\n\ntype NavigationState = {\n  selectedGrade: string | null;\n  selectedSubject: string | null;\n  selectedTeacher: boolean;\n  selectedStudent: string | null;\n  userType: \"teacher\" | \"parent\" | null;\n};\n\nconst Quiz = () => {\n  const { standardId } = useParams<{ standardId: string }>();\n  const [searchParams] = useSearchParams();\n  const subIndicatorId = searchParams.get('subIndicator');\n  const navigate = useNavigate();\n  const location = useLocation();\n  const returnState = (location.state ?? null) as NavigationState | null;\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);\n  const [answers, setAnswers] = useState<(number | null)[]>([]);\n  const [showResult, setShowResult] = useState(false);\n  const [showFeedback, setShowFeedback] = useState(false);\n  const [isAnswerSubmitted, setIsAnswerSubmitted] = useState(false);\n  const [showPassage, setShowPassage] = useState(true);\n  const reportRef = useRef<HTMLDivElement>(null);\n\n  // الحصول على اسم الطالب من sessionStorage\n  const studentName = sessionStorage.getItem('selectedStudent') || '';\n\n  const standard = standardId ? getStandardById(standardId) : null;\n  const subIndicatorInfo = subIndicatorId ? getSubIndicatorById(subIndicatorId) : null;\n  \n  // الحصول على الأسئلة حسب المؤشر الفرعي إذا كان موجوداً\n  const questions = useMemo(() => {\n    if (!standardId) return [];\n    if (subIndicatorId) {\n      return getQuestionsBySubIndicator(standardId, subIndicatorId);\n    }\n    return getQuestionsByStandard(standardId);\n  }, [standardId, subIndicatorId]);\n  \n  const currentQuestion = questions[currentQuestionIndex];\n  const progress = questions.length > 0 ? ((currentQuestionIndex + 1) / questions.length) * 100 : 0;\n\n  // تحديد القطعة النصية للسؤال الحالي\n  const getCurrentPassage = () => {\n    if (!currentQuestion) return null;\n    \n    // التحقق من وجود passage في السؤال واستخدامه مباشرة\n    if (currentQuestion.passage && passages[currentQuestion.passage]) {\n      return passages[currentQuestion.passage];\n    }\n    \n    // للصف الثالث - الأسئلة القديمة التي لا تحتوي على passage\n    if (standardId?.startsWith('std-r3')) {\n      const questionId = currentQuestion.id;\n      if (questionId.includes('r3-1-') || questionId.includes('r3-2-') || questionId.includes('r3-3-')) {\n        const qNum = parseInt(questionId.split('-').pop() || '0');\n        if (qNum >= 1 && qNum <= 10) return passages.satellites;\n        if (qNum >= 11 && qNum <= 20) return passages.altruism;\n        if (qNum >= 21 && qNum <= 30) return passages.blueWhale;\n      }\n    }\n    \n    return null;\n  };\n\n  const currentPassage = getCurrentPassage();\n\n  const handleSelectAnswer = (index: number) => {\n    if (isAnswerSubmitted) return;\n    setSelectedAnswer(index);\n  };\n\n  const handleSubmitAnswer = () => {\n    if (selectedAnswer === null) return;\n    setIsAnswerSubmitted(true);\n    setShowFeedback(true);\n  };\n\n  const handleSkipQuestion = () => {\n    const newAnswers = [...answers, null]; // null يعني تم تخطي السؤال\n    setAnswers(newAnswers);\n    \n    if (currentQuestionIndex < questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setSelectedAnswer(null);\n      setShowFeedback(false);\n      setIsAnswerSubmitted(false);\n    } else {\n      setShowResult(true);\n    }\n  };\n\n  const handleNext = () => {\n    const newAnswers = [...answers, selectedAnswer!];\n    setAnswers(newAnswers);\n    \n    if (currentQuestionIndex < questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setSelectedAnswer(null);\n      setShowFeedback(false);\n      setIsAnswerSubmitted(false);\n    } else {\n      setShowResult(true);\n    }\n  };\n\n  const calculateScore = () => {\n    let correct = 0;\n    answers.forEach((answer, index) => {\n      if (answer !== null && answer === questions[index]?.correctAnswer) {\n        correct++;\n      }\n    });\n    return correct;\n  };\n\n  const getQuestionResults = (): QuestionResult[] => {\n    return questions.map((question, index) => ({\n      question,\n      userAnswer: answers[index] ?? -1, // -1 يعني تم تخطي السؤال\n      isCorrect: answers[index] !== null && answers[index] === question.correctAnswer\n    }));\n  };\n\n  const handlePrint = () => {\n    window.print();\n  };\n\n  const isCorrect = selectedAnswer === currentQuestion?.correctAnswer;\n  const arabicLetters = [\"أ\", \"ب\", \"ج\", \"د\"];\n\n  if (!standard || questions.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-16 text-center\">\n          <p className=\"text-xl text-muted-foreground\">لا توجد أسئلة لهذا المعيار</p>\n          <Button onClick={() => navigate(\"/\")} className=\"mt-4\">العودة للرئيسية</Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (showResult) {\n    const score = calculateScore();\n    const percentage = Math.round((score / questions.length) * 100);\n    const results = getQuestionResults();\n    \n    const getMasteryLevel = (percent: number) => {\n      if (percent >= 90) return { text: \"متقن\", color: \"text-green-600 dark:text-green-400\" };\n      if (percent >= 75) return { text: \"جيد جداً\", color: \"text-blue-600 dark:text-blue-400\" };\n      if (percent >= 60) return { text: \"جيد\", color: \"text-yellow-600 dark:text-yellow-400\" };\n      if (percent >= 50) return { text: \"مقبول\", color: \"text-orange-600 dark:text-orange-400\" };\n      return { text: \"يحتاج تحسين\", color: \"text-red-600 dark:text-red-400\" };\n    };\n\n    const mastery = getMasteryLevel(percentage);\n    \n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <div className=\"container mx-auto px-4 py-8\">\n          {/* تقرير الطباعة */}\n          <div ref={reportRef} className=\"print:block\">\n            {/* ملخص النتيجة */}\n            <Card className=\"max-w-4xl mx-auto shadow-medium animate-scale-in mb-8 print:shadow-none print:mb-4\">\n              <CardContent className=\"p-8 print:p-4\">\n                {/* رسالة النجاح */}\n                <SuccessResult />\n                \n                {/* رأس التقرير للطباعة */}\n                <div className=\"hidden print:block text-center mb-4 border-b pb-4\">\n                  <h1 className=\"text-xl font-bold\">ابتدائية سعد بن أبي وقاص</h1>\n                  <p className=\"text-sm text-muted-foreground\">تقرير اختبار محاكي لاختبارات نافس</p>\n                </div>\n\n                {/* اسم الطالب */}\n                {studentName && (\n                  <div className=\"text-center mb-6 p-4 bg-primary/10 rounded-lg print:bg-transparent print:border print:border-primary print:p-2 print:mb-2\">\n                    <p className=\"text-sm text-muted-foreground\">اسم الطالب</p>\n                    <p className=\"text-2xl font-bold text-primary print:text-lg\">{studentName}</p>\n                  </div>\n                )}\n\n                <div className=\"flex flex-col md:flex-row items-center gap-8 print:gap-4 print:flex-row\">\n                  <div className={`w-32 h-32 print:w-16 print:h-16 rounded-full flex items-center justify-center flex-shrink-0 ${percentage >= 60 ? 'bg-primary' : 'bg-destructive'}`}>\n                    {percentage >= 60 ? (\n                      <CheckCircle2 className=\"w-16 h-16 print:w-8 print:h-8 text-primary-foreground\" />\n                    ) : (\n                      <XCircle className=\"w-16 h-16 print:w-8 print:h-8 text-destructive-foreground\" />\n                    )}\n                  </div>\n                  <div className=\"flex-1 text-center md:text-right\">\n                    <h2 className=\"text-3xl print:text-lg font-bold text-foreground mb-2\">تقرير نتيجة الاختبار</h2>\n                    <p className=\"text-lg print:text-sm text-muted-foreground mb-4 print:mb-2\">\n                      {subIndicatorInfo ? subIndicatorInfo.subIndicator.name : standard.name}\n                    </p>\n                    \n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 print:gap-2 mt-6 print:mt-2\">\n                      <div className=\"bg-muted/50 rounded-lg p-4 print:p-2\">\n                        <p className=\"text-sm print:text-xs text-muted-foreground\">النسبة المئوية</p>\n                        <p className=\"text-3xl print:text-lg font-bold text-foreground\">{percentage}%</p>\n                      </div>\n                      <div className=\"bg-muted/50 rounded-lg p-4 print:p-2\">\n                        <p className=\"text-sm print:text-xs text-muted-foreground\">الإجابات الصحيحة</p>\n                        <p className=\"text-3xl print:text-lg font-bold text-green-600\">{score}</p>\n                      </div>\n                      <div className=\"bg-muted/50 rounded-lg p-4 print:p-2\">\n                        <p className=\"text-sm print:text-xs text-muted-foreground\">الإجابات الخاطئة</p>\n                        <p className=\"text-3xl print:text-lg font-bold text-red-600\">{questions.length - score}</p>\n                      </div>\n                      <div className=\"bg-muted/50 rounded-lg p-4 print:p-2\">\n                        <p className=\"text-sm print:text-xs text-muted-foreground\">مستوى الإتقان</p>\n                        <p className={`text-xl print:text-sm font-bold ${mastery.color}`}>{mastery.text}</p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* أزرار التحكم */}\n                <div className=\"flex flex-wrap gap-4 justify-center mt-8 print:hidden\">\n                  <Button onClick={() => navigate(\"/\")} variant=\"outline\">\n                    <ArrowRight className=\"w-4 h-4 ml-2\" />\n                    العودة للرئيسية\n                  </Button>\n                  <Button onClick={() => {\n                    setCurrentQuestionIndex(0);\n                    setAnswers([]);\n                    setSelectedAnswer(null);\n                    setShowResult(false);\n                    setShowFeedback(false);\n                    setIsAnswerSubmitted(false);\n                  }} className=\"btn-primary-gradient\">\n                    إعادة الاختبار\n                  </Button>\n                  <Button onClick={handlePrint} variant=\"outline\" className=\"gap-2\">\n                    <Printer className=\"w-4 h-4\" />\n                    طباعة التقرير\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* التقرير التفصيلي */}\n            <Card className=\"max-w-4xl mx-auto shadow-soft\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center gap-3 mb-6\">\n                  <FileText className=\"w-6 h-6 text-primary\" />\n                  <h3 className=\"text-xl font-bold text-foreground\">التقرير التفصيلي للأسئلة</h3>\n                </div>\n\n                <div className=\"space-y-6\">\n                  {results.map((result, index) => (\n                    <div \n                      key={result.question.id} \n                      className={`p-4 rounded-lg border-2 ${\n                        result.isCorrect \n                          ? 'bg-green-500/5 border-green-500/30' \n                          : 'bg-red-500/5 border-red-500/30'\n                      }`}\n                    >\n                      <div className=\"flex items-start gap-3\">\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${\n                          result.isCorrect ? 'bg-green-500' : 'bg-red-500'\n                        }`}>\n                          {result.isCorrect ? (\n                            <Check className=\"w-5 h-5 text-white\" />\n                          ) : (\n                            <X className=\"w-5 h-5 text-white\" />\n                          )}\n                        </div>\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <span className=\"text-sm font-medium text-muted-foreground\">السؤال {index + 1}</span>\n                            <span className={`text-xs px-2 py-0.5 rounded-full ${\n                              result.isCorrect \n                                ? 'bg-green-500/20 text-green-700 dark:text-green-400' \n                                : 'bg-red-500/20 text-red-700 dark:text-red-400'\n                            }`}>\n                              {result.isCorrect ? 'صحيح' : 'خاطئ'}\n                            </span>\n                          </div>\n                          <p className=\"font-medium text-foreground mb-3\">{result.question.text}</p>\n                          \n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 mb-3\">\n                            {result.question.options.map((option, optIndex) => {\n                              const isUserChoice = optIndex === result.userAnswer;\n                              const isCorrectOption = optIndex === result.question.correctAnswer;\n                              \n                              let optionClass = \"text-muted-foreground\";\n                              if (isCorrectOption) optionClass = \"text-green-700 dark:text-green-400 font-medium\";\n                              if (isUserChoice && !result.isCorrect) optionClass = \"text-red-700 dark:text-red-400 line-through\";\n                              \n                              return (\n                                <div key={optIndex} className={`flex items-center gap-2 text-sm ${optionClass}`}>\n                                  <span>{arabicLetters[optIndex]}.</span>\n                                  <span>{option}</span>\n                                  {isCorrectOption && <Check className=\"w-4 h-4 text-green-600\" />}\n                                  {isUserChoice && !result.isCorrect && <X className=\"w-4 h-4 text-red-600\" />}\n                                </div>\n                              );\n                            })}\n                          </div>\n\n                          <div className={`p-3 rounded-lg ${\n                            result.isCorrect \n                              ? 'bg-green-500/10' \n                              : 'bg-amber-500/10'\n                          }`}>\n                            <div className=\"flex items-start gap-2\">\n                              <Lightbulb className={`w-4 h-4 mt-0.5 flex-shrink-0 ${\n                                result.isCorrect ? 'text-green-600' : 'text-amber-600'\n                              }`} />\n                              <p className=\"text-sm text-foreground\">\n                                {generateDetailedExplanation(result.question, result.userAnswer)}\n                              </p>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                {/* ملخص نهائي للطباعة */}\n                <div className=\"mt-4 p-2 bg-muted/50 rounded-lg print:block hidden border-t\">\n                  <p className=\"text-center text-muted-foreground text-xs\">\n                    تاريخ الاختبار: {new Date().toLocaleDateString('ar-SA')} | \n                    {studentName && ` الطالب: ${studentName} |`}\n                    المعيار: {standard.name} | \n                    النتيجة: {score}/{questions.length} ({percentage}%)\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* أنماط الطباعة */}\n        <style>{`\n          @media print {\n            body {\n              -webkit-print-color-adjust: exact;\n              print-color-adjust: exact;\n            }\n            body * {\n              visibility: visible;\n            }\n            .print\\\\:hidden {\n              display: none !important;\n            }\n            .print\\\\:block {\n              display: block !important;\n            }\n            @page {\n              margin: 0.5cm;\n              size: A4;\n            }\n            .space-y-6 > * {\n              page-break-inside: avoid;\n              margin-bottom: 8px !important;\n            }\n            .space-y-6 {\n              gap: 8px !important;\n            }\n            p, h3, h4 {\n              font-size: 10px !important;\n              line-height: 1.3 !important;\n            }\n            .text-xl {\n              font-size: 12px !important;\n            }\n            .text-2xl, .text-3xl {\n              font-size: 14px !important;\n            }\n            .p-4 {\n              padding: 6px !important;\n            }\n            .p-3 {\n              padding: 4px !important;\n            }\n            .mb-3, .mb-4, .mb-6 {\n              margin-bottom: 4px !important;\n            }\n            .gap-4, .gap-6 {\n              gap: 4px !important;\n            }\n            .rounded-lg {\n              border-radius: 4px !important;\n            }\n          }\n        `}</style>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      <div className=\"container mx-auto px-4 py-8\">\n        <Button \n          variant=\"ghost\" \n          onClick={() => {\n            if (returnState) {\n              navigate(\"/\", { state: returnState });\n              return;\n            }\n            navigate(\"/\");\n          }} \n          className=\"mb-4 text-muted-foreground\"\n        >\n          <ArrowRight className=\"w-4 h-4 ml-1\" />\n          العودة للمعايير\n        </Button>\n\n        <div className=\"max-w-2xl mx-auto\">\n          <div className=\"mb-6\">\n            <p className=\"text-sm text-muted-foreground mb-2\">\n              {subIndicatorInfo ? (\n                <span>\n                  {standard.name} - <span className=\"text-primary font-medium\">{subIndicatorInfo.subIndicator.name}</span>\n                </span>\n              ) : standard.name}\n            </p>\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-foreground font-medium\">السؤال {currentQuestionIndex + 1} من {questions.length}</span>\n              <span className=\"text-muted-foreground\">{Math.round(progress)}%</span>\n            </div>\n            <Progress value={progress} className=\"h-2\" />\n          </div>\n\n          <Card className=\"shadow-soft animate-fade-in\">\n            <CardContent className=\"p-6\">\n              {/* عرض القطعة النصية */}\n              {currentPassage && (\n                <div className=\"mb-6 p-4 bg-muted/50 rounded-lg border border-border\">\n                  <button\n                    onClick={() => setShowPassage(!showPassage)}\n                    className=\"w-full flex items-center justify-between text-right mb-2\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <BookOpen className=\"w-5 h-5 text-primary\" />\n                      <span className=\"font-bold text-foreground\">القطعة النصية: {currentPassage.title}</span>\n                    </div>\n                    {showPassage ? <ChevronUp className=\"w-5 h-5\" /> : <ChevronDown className=\"w-5 h-5\" />}\n                  </button>\n                  {showPassage && (\n                    <div className=\"text-sm text-foreground leading-relaxed whitespace-pre-line max-h-64 overflow-y-auto pr-2\">\n                      {currentPassage.text}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              <h3 className=\"text-xl font-bold text-foreground mb-6\">{currentQuestion.text}</h3>\n              \n              {/* عرض صورة السؤال إن وجدت */}\n              {currentQuestion.image && (\n                <div className=\"mb-6 flex justify-center\">\n                  <img \n                    src={currentQuestion.image} \n                    alt=\"صورة توضيحية للسؤال\" \n                    className=\"max-w-xs rounded-lg border border-border shadow-sm\"\n                  />\n                </div>\n              )}\n              \n              <div className=\"space-y-3\">\n                {currentQuestion.options.map((option, index) => {\n                  const isSelected = selectedAnswer === index;\n                  const isCorrectOption = index === currentQuestion.correctAnswer;\n                  \n                  let buttonStyle = \"border-border bg-card hover:border-muted-foreground text-foreground\";\n                  \n                  if (showFeedback) {\n                    if (isCorrectOption) {\n                      buttonStyle = \"border-green-500 bg-green-500/20 text-foreground\";\n                    } else if (isSelected && !isCorrectOption) {\n                      buttonStyle = \"border-red-500 bg-red-500/20 text-foreground\";\n                    } else {\n                      buttonStyle = \"border-border bg-card text-muted-foreground opacity-50\";\n                    }\n                  } else if (isSelected) {\n                    buttonStyle = \"border-primary bg-primary/10 text-foreground\";\n                  }\n                  \n                  return (\n                    <button\n                      key={index}\n                      onClick={() => handleSelectAnswer(index)}\n                      disabled={isAnswerSubmitted}\n                      className={`w-full text-right p-4 rounded-lg border-2 transition-all duration-200 flex items-center justify-between ${buttonStyle} ${isAnswerSubmitted ? 'cursor-default' : 'cursor-pointer'}`}\n                    >\n                      <div className=\"flex items-center\">\n                        <span className=\"font-medium ml-3\">{arabicLetters[index]}.</span>\n                        {option}\n                      </div>\n                      {showFeedback && isCorrectOption && (\n                        <Check className=\"w-6 h-6 text-green-600 flex-shrink-0\" />\n                      )}\n                      {showFeedback && isSelected && !isCorrectOption && (\n                        <X className=\"w-6 h-6 text-red-600 flex-shrink-0\" />\n                      )}\n                    </button>\n                  );\n                })}\n              </div>\n\n              {/* صندوق التغذية الراجعة */}\n              {showFeedback && selectedAnswer !== null && (\n                <div className={`mt-6 p-4 rounded-lg border-2 animate-fade-in ${isCorrect ? 'bg-green-500/10 border-green-500' : 'bg-amber-500/10 border-amber-500'}`}>\n                  <div className=\"flex items-start gap-3\">\n                    <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${isCorrect ? 'bg-green-500' : 'bg-amber-500'}`}>\n                      {isCorrect ? (\n                        <Check className=\"w-6 h-6 text-white\" />\n                      ) : (\n                        <Lightbulb className=\"w-6 h-6 text-white\" />\n                      )}\n                    </div>\n                    <div>\n                      <h4 className={`font-bold mb-1 ${isCorrect ? 'text-green-700 dark:text-green-400' : 'text-amber-700 dark:text-amber-400'}`}>\n                        {isCorrect ? \"إجابة صحيحة! أحسنت\" : \"إجابة خاطئة\"}\n                      </h4>\n                      <p className=\"text-foreground text-sm leading-relaxed\">\n                        {generateDetailedExplanation(currentQuestion, selectedAnswer)}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {!showFeedback ? (\n                <div className=\"flex gap-3 mt-6\">\n                  <Button\n                    onClick={handleSubmitAnswer}\n                    disabled={selectedAnswer === null}\n                    className=\"flex-1 btn-primary-gradient disabled:opacity-50\"\n                  >\n                    تأكيد الإجابة\n                  </Button>\n                  <Button\n                    onClick={handleSkipQuestion}\n                    variant=\"outline\"\n                    className=\"gap-2\"\n                  >\n                    <SkipForward className=\"w-4 h-4\" />\n                    تخطي\n                  </Button>\n                </div>\n              ) : (\n                <Button\n                  onClick={handleNext}\n                  className=\"w-full mt-6 btn-primary-gradient\"\n                >\n                  {currentQuestionIndex < questions.length - 1 ? \"السؤال التالي\" : \"إنهاء الاختبار\"}\n                </Button>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Quiz;\n"
  },
  {
    "path": "src/pages/TrainingGalleryPage.tsx",
    "content": "import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowRight, Shield } from \"lucide-react\";\nimport TrainingGallery from \"@/components/TrainingGallery\";\nimport AdminLogin from \"@/components/AdminLogin\";\nimport AdminPanel from \"@/components/AdminPanel\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\nconst TrainingGalleryPage = () => {\n  const navigate = useNavigate();\n  const [showAdminLogin, setShowAdminLogin] = useState(false);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [isCheckingAuth, setIsCheckingAuth] = useState(true);\n\n  useEffect(() => {\n    const checkAdminStatus = async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (session?.user) {\n        const { data: roleData } = await supabase\n          .from(\"user_roles\")\n          .select(\"role\")\n          .eq(\"user_id\", session.user.id)\n          .eq(\"role\", \"admin\")\n          .maybeSingle();\n        \n        if (roleData) {\n          setIsAdmin(true);\n        }\n      }\n      setIsCheckingAuth(false);\n    };\n\n    checkAdminStatus();\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {\n      if (event === 'SIGNED_OUT') {\n        setIsAdmin(false);\n        setShowAdminLogin(false);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  const handleLoginSuccess = () => {\n    setIsAdmin(true);\n    setShowAdminLogin(false);\n  };\n\n  const handleLogout = () => {\n    setIsAdmin(false);\n    setShowAdminLogin(false);\n  };\n\n  if (isCheckingAuth) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div \n      className=\"min-h-screen bg-background bg-cover bg-center bg-no-repeat bg-fixed\"\n      style={{ backgroundImage: \"url('/images/nafs-background.jpeg')\" }}\n    >\n      <div className=\"min-h-screen bg-background/85 dark:bg-background/90\">\n        <div className=\"container mx-auto px-4 py-6\">\n          <Button \n            variant=\"ghost\" \n            size=\"sm\" \n            onClick={() => navigate(\"/\")} \n            className=\"text-muted-foreground hover:text-foreground mb-4\"\n          >\n            <ArrowRight className=\"w-4 h-4 ml-1\" />\n            رجوع للرئيسية\n          </Button>\n        </div>\n\n        {isAdmin ? (\n          <div className=\"container mx-auto px-4 pb-8\">\n            <AdminPanel onLogout={handleLogout} />\n          </div>\n        ) : showAdminLogin ? (\n          <div className=\"container mx-auto px-4 pb-8\">\n            <Button \n              variant=\"ghost\" \n              size=\"sm\" \n              onClick={() => setShowAdminLogin(false)} \n              className=\"text-muted-foreground hover:text-foreground mb-4\"\n            >\n              <ArrowRight className=\"w-4 h-4 ml-1\" />\n              رجوع للمعرض\n            </Button>\n            <AdminLogin onLoginSuccess={handleLoginSuccess} />\n          </div>\n        ) : (\n          <>\n            <TrainingGallery />\n            <div className=\"flex justify-center pb-8 mt-8\">\n              <Button \n                variant=\"outline\" \n                onClick={() => setShowAdminLogin(true)}\n                className=\"gap-2\"\n              >\n                <Shield className=\"w-4 h-4\" />\n                دخول المسؤول\n              </Button>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default TrainingGalleryPage;\n"
  }
]