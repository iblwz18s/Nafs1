[
  {
    "path": "src/components/AdminPanel.tsx",
    "content": "import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { toast } from \"sonner\";\nimport { Loader2, Upload, UserPlus, LogOut, Trash2, Image, Pencil, Key } from \"lucide-react\";\n\ninterface TrainingImage {\n  id: string;\n  file_path: string;\n  file_name: string;\n  created_at: string;\n}\n\ninterface Student {\n  id: string;\n  student_name: string;\n  parent_name: string;\n  phone_number: string;\n  pin_code: string;\n  grade: string;\n}\n\ninterface AdminPanelProps {\n  onLogout: () => void;\n}\n\n// Helper function to normalize grade values\nconst normalizeGrade = (grade: string): string => {\n  if (grade.startsWith(\"grade-\")) return grade.replace(\"grade-\", \"\");\n  return grade;\n};\n\nconst AdminPanel = ({ onLogout }: AdminPanelProps) => {\n  const [isUploading, setIsUploading] = useState(false);\n  const [isAddingStudent, setIsAddingStudent] = useState(false);\n  const [trainingImages, setTrainingImages] = useState<TrainingImage[]>([]);\n  const [students, setStudents] = useState<Student[]>([]);\n  const [isLoadingImages, setIsLoadingImages] = useState(true);\n  const [isLoadingStudents, setIsLoadingStudents] = useState(true);\n\n  // Student form state\n  const [studentName, setStudentName] = useState(\"\");\n  const [parentName, setParentName] = useState(\"\");\n  const [phoneNumber, setPhoneNumber] = useState(\"\");\n  const [selectedGrade, setSelectedGrade] = useState(\"\");\n\n  // Edit student state\n  const [editingStudent, setEditingStudent] = useState<Student | null>(null);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editStudentName, setEditStudentName] = useState(\"\");\n  const [editParentName, setEditParentName] = useState(\"\");\n  const [editPhoneNumber, setEditPhoneNumber] = useState(\"\");\n  const [editGrade, setEditGrade] = useState(\"\");\n  const [isUpdatingStudent, setIsUpdatingStudent] = useState(false);\n\n  // Delete confirmation state\n  const [studentToDelete, setStudentToDelete] = useState<Student | null>(null);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n\n  useEffect(() => {\n    fetchTrainingImages();\n    fetchStudents();\n  }, []);\n\n  const fetchTrainingImages = async () => {\n    setIsLoadingImages(true);\n    const { data, error } = await supabase\n      .from(\"training_images\")\n      .select(\"*\")\n      .order(\"created_at\", { ascending: false });\n\n    if (error) {\n      console.error(\"Error fetching images:\", error);\n    } else {\n      setTrainingImages(data || []);\n    }\n    setIsLoadingImages(false);\n  };\n\n  const fetchStudents = async () => {\n    setIsLoadingStudents(true);\n    const { data, error } = await supabase\n      .from(\"students\")\n      .select(\"*\")\n      .order(\"student_name\", { ascending: true });\n\n    if (error) {\n      console.error(\"Error fetching students:\", error);\n    } else {\n      setStudents(data || []);\n    }\n    setIsLoadingStudents(false);\n  };\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    setIsUploading(true);\n\n    try {\n      for (const file of Array.from(files)) {\n        const fileExt = file.name.split(\".\").pop();\n        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\n        const filePath = `training/${fileName}`;\n\n        const { error: uploadError } = await supabase.storage\n          .from(\"training-images\")\n          .upload(filePath, file);\n\n        if (uploadError) {\n          toast.error(`خطأ في رفع ${file.name}: ${uploadError.message}`);\n          continue;\n        }\n\n        // Save metadata to database\n        const { error: dbError } = await supabase\n          .from(\"training_images\")\n          .insert({\n            file_path: filePath,\n            file_name: file.name,\n          });\n\n        if (dbError) {\n          toast.error(`خطأ في حفظ بيانات ${file.name}`);\n        }\n      }\n\n      toast.success(\"تم رفع الصور بنجاح\");\n      fetchTrainingImages();\n    } catch (error) {\n      toast.error(\"حدث خطأ أثناء رفع الصور\");\n    } finally {\n      setIsUploading(false);\n      e.target.value = \"\";\n    }\n  };\n\n  const handleDeleteImage = async (image: TrainingImage) => {\n    try {\n      // Delete from storage\n      const { error: storageError } = await supabase.storage\n        .from(\"training-images\")\n        .remove([image.file_path]);\n\n      if (storageError) {\n        toast.error(\"خطأ في حذف الصورة من التخزين\");\n        return;\n      }\n\n      // Delete from database\n      const { error: dbError } = await supabase\n        .from(\"training_images\")\n        .delete()\n        .eq(\"id\", image.id);\n\n      if (dbError) {\n        toast.error(\"خطأ في حذف بيانات الصورة\");\n        return;\n      }\n\n      toast.success(\"تم حذف الصورة بنجاح\");\n      fetchTrainingImages();\n    } catch (error) {\n      toast.error(\"حدث خطأ أثناء حذف الصورة\");\n    }\n  };\n\n  const handleAddStudent = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!studentName || !parentName || !phoneNumber || !selectedGrade) {\n      toast.error(\"يرجى ملء جميع الحقول\");\n      return;\n    }\n\n    // Validate phone number (should be 10 digits)\n    if (phoneNumber.length !== 10 || !/^\\d+$/.test(phoneNumber)) {\n      toast.error(\"رقم الجوال يجب أن يكون 10 أرقام\");\n      return;\n    }\n\n    setIsAddingStudent(true);\n\n    try {\n      // Generate PIN from last 4 digits of phone number\n      const pinCode = phoneNumber.slice(-4);\n\n      const { error } = await supabase.from(\"students\").insert({\n        student_name: studentName,\n        parent_name: parentName,\n        phone_number: phoneNumber,\n        pin_code: pinCode,\n        grade: `grade-${selectedGrade}`,\n      });\n\n      if (error) {\n        toast.error(\"خطأ في إضافة الطالب: \" + error.message);\n        return;\n      }\n\n      toast.success(\"تم إضافة الطالب بنجاح\");\n      setStudentName(\"\");\n      setParentName(\"\");\n      setPhoneNumber(\"\");\n      setSelectedGrade(\"\");\n      fetchStudents();\n    } catch (error) {\n      toast.error(\"حدث خطأ غير متوقع\");\n    } finally {\n      setIsAddingStudent(false);\n    }\n  };\n\n  const openEditDialog = (student: Student) => {\n    setEditingStudent(student);\n    setEditStudentName(student.student_name);\n    setEditParentName(student.parent_name);\n    setEditPhoneNumber(student.phone_number);\n    setEditGrade(normalizeGrade(student.grade));\n    setIsEditDialogOpen(true);\n  };\n\n  const handleUpdateStudent = async () => {\n    if (!editingStudent) return;\n\n    if (!editStudentName || !editParentName || !editPhoneNumber || !editGrade) {\n      toast.error(\"يرجى ملء جميع الحقول\");\n      return;\n    }\n\n    if (editPhoneNumber.length !== 10 || !/^\\d+$/.test(editPhoneNumber)) {\n      toast.error(\"رقم الجوال يجب أن يكون 10 أرقام\");\n      return;\n    }\n\n    setIsUpdatingStudent(true);\n\n    try {\n      const newPinCode = editPhoneNumber.slice(-4);\n\n      const { error } = await supabase\n        .from(\"students\")\n        .update({\n          student_name: editStudentName,\n          parent_name: editParentName,\n          phone_number: editPhoneNumber,\n          pin_code: newPinCode,\n          grade: `grade-${editGrade}`,\n        })\n        .eq(\"id\", editingStudent.id);\n\n      if (error) {\n        toast.error(\"خطأ في تحديث بيانات الطالب: \" + error.message);\n        return;\n      }\n\n      toast.success(\"تم تحديث بيانات الطالب بنجاح\");\n      setIsEditDialogOpen(false);\n      setEditingStudent(null);\n      fetchStudents();\n    } catch (error) {\n      toast.error(\"حدث خطأ غير متوقع\");\n    } finally {\n      setIsUpdatingStudent(false);\n    }\n  };\n\n  const confirmDeleteStudent = (student: Student) => {\n    setStudentToDelete(student);\n    setIsDeleteDialogOpen(true);\n  };\n\n  const handleDeleteStudent = async () => {\n    if (!studentToDelete) return;\n\n    try {\n      const { error } = await supabase\n        .from(\"students\")\n        .delete()\n        .eq(\"id\", studentToDelete.id);\n\n      if (error) {\n        toast.error(\"خطأ في حذف الطالب\");\n        return;\n      }\n\n      toast.success(\"تم حذف الطالب بنجاح\");\n      setIsDeleteDialogOpen(false);\n      setStudentToDelete(null);\n      fetchStudents();\n    } catch (error) {\n      toast.error(\"حدث خطأ أثناء حذف الطالب\");\n    }\n  };\n\n  const handleLogout = async () => {\n    await supabase.auth.signOut();\n    onLogout();\n    toast.success(\"تم تسجيل الخروج\");\n  };\n\n  const getImageUrl = (filePath: string) => {\n    const { data } = supabase.storage\n      .from(\"training-images\")\n      .getPublicUrl(filePath);\n    return data.publicUrl;\n  };\n\n  // Get students by normalized grade\n  const getStudentsByGrade = (grade: string) => {\n    return students.filter((s) => normalizeGrade(s.grade) === grade)\n      .sort((a, b) => a.student_name.localeCompare(b.student_name, \"ar\"));\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold\">لوحة تحكم المسؤول</h2>\n        <Button variant=\"outline\" onClick={handleLogout}>\n          <LogOut className=\"w-4 h-4 ml-2\" />\n          تسجيل الخروج\n        </Button>\n      </div>\n\n      <Tabs defaultValue=\"images\" dir=\"rtl\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"images\">شواهد التدريب</TabsTrigger>\n          <TabsTrigger value=\"students\">إدارة الطلاب</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"images\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Upload className=\"w-5 h-5\" />\n                رفع شواهد التدريب\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"images\">اختر الصور للرفع</Label>\n                  <Input\n                    id=\"images\"\n                    type=\"file\"\n                    accept=\"image/*\"\n                    multiple\n                    onChange={handleImageUpload}\n                    disabled={isUploading}\n                    className=\"mt-2\"\n                  />\n                </div>\n                {isUploading && (\n                  <div className=\"flex items-center gap-2 text-muted-foreground\">\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                    جاري رفع الصور...\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Image className=\"w-5 h-5\" />\n                الصور المرفوعة ({trainingImages.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isLoadingImages ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"w-6 h-6 animate-spin\" />\n                </div>\n              ) : trainingImages.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  لا توجد صور مرفوعة حتى الآن\n                </p>\n              ) : (\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n                  {trainingImages.map((image) => (\n                    <div\n                      key={image.id}\n                      className=\"relative group rounded-lg overflow-hidden border\"\n                    >\n                      <img\n                        src={getImageUrl(image.file_path)}\n                        alt={image.file_name}\n                        className=\"w-full h-32 object-cover\"\n                      />\n                      <Button\n                        variant=\"destructive\"\n                        size=\"icon\"\n                        className=\"absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition-opacity\"\n                        onClick={() => handleDeleteImage(image)}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"students\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <UserPlus className=\"w-5 h-5\" />\n                إضافة طالب جديد\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleAddStudent} className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"studentName\">اسم الطالب</Label>\n                    <Input\n                      id=\"studentName\"\n                      value={studentName}\n                      onChange={(e) => setStudentName(e.target.value)}\n                      placeholder=\"أدخل اسم الطالب\"\n                      required\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"parentName\">اسم ولي الأمر</Label>\n                    <Input\n                      id=\"parentName\"\n                      value={parentName}\n                      onChange={(e) => setParentName(e.target.value)}\n                      placeholder=\"أدخل اسم ولي الأمر\"\n                      required\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"phoneNumber\">رقم جوال ولي الأمر</Label>\n                    <Input\n                      id=\"phoneNumber\"\n                      value={phoneNumber}\n                      onChange={(e) => setPhoneNumber(e.target.value)}\n                      placeholder=\"05xxxxxxxx\"\n                      maxLength={10}\n                      required\n                      dir=\"ltr\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>الصف</Label>\n                    <Select value={selectedGrade} onValueChange={setSelectedGrade}>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"اختر الصف\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"3\">الصف الثالث</SelectItem>\n                        <SelectItem value=\"6\">الصف السادس</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <Button type=\"submit\" disabled={isAddingStudent}>\n                  {isAddingStudent ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n                  ) : (\n                    <UserPlus className=\"w-4 h-4 ml-2\" />\n                  )}\n                  إضافة الطالب\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>قائمة الطلاب ({students.length})</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isLoadingStudents ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"w-6 h-6 animate-spin\" />\n                </div>\n              ) : students.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  لا يوجد طلاب مسجلين\n                </p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {[\"3\", \"6\"].map((grade) => {\n                    const gradeStudents = getStudentsByGrade(grade);\n                    if (gradeStudents.length === 0) return null;\n                    return (\n                      <div key={grade}>\n                        <h3 className=\"font-semibold mb-2\">\n                          الصف {grade === \"3\" ? \"الثالث\" : \"السادس\"} ({gradeStudents.length} طالب)\n                        </h3>\n                        <div className=\"grid gap-2\">\n                          {gradeStudents.map((student) => (\n                            <div\n                              key={student.id}\n                              className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\"\n                            >\n                              <div className=\"flex-1\">\n                                <p className=\"font-medium\">{student.student_name}</p>\n                                <p className=\"text-sm text-muted-foreground\">\n                                  ولي الأمر: {student.parent_name} | الجوال: {student.phone_number}\n                                </p>\n                                <p className=\"text-xs text-muted-foreground flex items-center gap-1 mt-1\">\n                                  <Key className=\"w-3 h-3\" />\n                                  رمز الدخول: <span className=\"font-mono font-bold\">{student.pin_code}</span>\n                                </p>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-primary hover:text-primary\"\n                                  onClick={() => openEditDialog(student)}\n                                >\n                                  <Pencil className=\"w-4 h-4\" />\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-destructive hover:text-destructive\"\n                                  onClick={() => confirmDeleteStudent(student)}\n                                >\n                                  <Trash2 className=\"w-4 h-4\" />\n                                </Button>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Edit Student Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent dir=\"rtl\">\n          <DialogHeader>\n            <DialogTitle>تعديل بيانات الطالب</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"editStudentName\">اسم الطالب</Label>\n              <Input\n                id=\"editStudentName\"\n                value={editStudentName}\n                onChange={(e) => setEditStudentName(e.target.value)}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"editParentName\">اسم ولي الأمر</Label>\n              <Input\n                id=\"editParentName\"\n                value={editParentName}\n                onChange={(e) => setEditParentName(e.target.value)}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"editPhoneNumber\">رقم الجوال</Label>\n              <Input\n                id=\"editPhoneNumber\"\n                value={editPhoneNumber}\n                onChange={(e) => setEditPhoneNumber(e.target.value)}\n                maxLength={10}\n                dir=\"ltr\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                سيتم تحديث رمز الدخول تلقائياً لآخر 4 أرقام من الجوال\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>الصف</Label>\n              <Select value={editGrade} onValueChange={setEditGrade}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"3\">الصف الثالث</SelectItem>\n                  <SelectItem value=\"6\">الصف السادس</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter className=\"gap-2\">\n            <Button variant=\"outline\" onClick={() => setIsEditDialogOpen(false)}>\n              إلغاء\n            </Button>\n            <Button onClick={handleUpdateStudent} disabled={isUpdatingStudent}>\n              {isUpdatingStudent && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n              حفظ التغييرات\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n        <AlertDialogContent dir=\"rtl\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>تأكيد حذف الطالب</AlertDialogTitle>\n            <AlertDialogDescription>\n              هل أنت متأكد من حذف الطالب \"{studentToDelete?.student_name}\"؟\n              <br />\n              لا يمكن التراجع عن هذا الإجراء.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel>إلغاء</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteStudent}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              حذف\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n};\n\nexport default AdminPanel;\n"
  },
  {
    "path": "src/components/AnimatedList.css",
    "content": "/* AnimatedList Styles - متوافق مع نظام التصميم */\n.animated-list-container {\n  position: relative;\n  width: 100%;\n}\n\n.animated-list {\n  max-height: 500px;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.animated-list::-webkit-scrollbar {\n  width: 8px;\n}\n\n.animated-list::-webkit-scrollbar-track {\n  background: hsl(var(--muted));\n  border-radius: 4px;\n}\n\n.animated-list::-webkit-scrollbar-thumb {\n  background: hsl(var(--border));\n  border-radius: 4px;\n}\n\n.animated-list::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--primary) / 0.5);\n}\n\n.no-scrollbar::-webkit-scrollbar {\n  display: none;\n}\n\n.no-scrollbar {\n  -ms-overflow-style: none;\n  scrollbar-width: none;\n}\n\n.animated-list-item {\n  padding: 0;\n  border-radius: 0.75rem;\n  margin-bottom: 0.75rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.animated-list-item.selected {\n  transform: scale(1.01);\n}\n\n.top-gradient {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 40px;\n  background: linear-gradient(to bottom, hsl(var(--background)), transparent);\n  pointer-events: none;\n  transition: opacity 0.3s ease;\n  z-index: 10;\n}\n\n.bottom-gradient {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 80px;\n  background: linear-gradient(to top, hsl(var(--background)), transparent);\n  pointer-events: none;\n  transition: opacity 0.3s ease;\n  z-index: 10;\n}\n\n/* Dark mode support */\n.dark .animated-list::-webkit-scrollbar-track {\n  background: hsl(var(--muted));\n}\n\n.dark .animated-list::-webkit-scrollbar-thumb {\n  background: hsl(var(--border));\n}\n"
  },
  {
    "path": "src/components/AnimatedList.tsx",
    "content": "import { useRef, useState, useEffect, useCallback, ReactNode } from \"react\";\nimport { motion, useInView } from \"motion/react\";\nimport \"./AnimatedList.css\";\n\ninterface AnimatedItemProps {\n  children: ReactNode;\n  delay?: number;\n  index: number;\n  onMouseEnter: (index: number) => void;\n  onClick: () => void;\n}\n\nconst AnimatedItem = ({ children, delay = 0, index, onMouseEnter, onClick }: AnimatedItemProps) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const inView = useInView(ref, { amount: 0.5, once: false });\n\n  return (\n    <motion.div\n      ref={ref}\n      data-index={index}\n      initial={{ scale: 0.7, opacity: 0 }}\n      animate={inView ? { scale: 1, opacity: 1 } : { scale: 0.7, opacity: 0 }}\n      transition={{\n        duration: 0.2,\n        delay: delay,\n        ease: [0.21, 0.47, 0.32, 0.98],\n      }}\n      onMouseEnter={() => onMouseEnter(index)}\n      onClick={onClick}\n    >\n      {children}\n    </motion.div>\n  );\n};\n\ninterface AnimatedListProps {\n  items: ReactNode[];\n  onItemSelect?: (item: ReactNode, index: number) => void;\n  showGradients?: boolean;\n  enableArrowNavigation?: boolean;\n  className?: string;\n  itemClassName?: string;\n  displayScrollbar?: boolean;\n  initialSelectedIndex?: number;\n}\n\nconst AnimatedList = ({\n  items = [],\n  onItemSelect,\n  showGradients = true,\n  enableArrowNavigation = true,\n  className = \"\",\n  itemClassName = \"\",\n  displayScrollbar = true,\n  initialSelectedIndex = -1,\n}: AnimatedListProps) => {\n  const listRef = useRef<HTMLDivElement>(null);\n  const [selectedIndex, setSelectedIndex] = useState(initialSelectedIndex);\n  const [keyboardNav, setKeyboardNav] = useState(false);\n  const [topGradientOpacity, setTopGradientOpacity] = useState(0);\n  const [bottomGradientOpacity, setBottomGradientOpacity] = useState(1);\n\n  const handleItemMouseEnter = useCallback((index: number) => {\n    setSelectedIndex(index);\n  }, []);\n\n  const handleItemClick = useCallback(\n    (item: ReactNode, index: number) => {\n      setSelectedIndex(index);\n      if (onItemSelect) {\n        onItemSelect(item, index);\n      }\n    },\n    [onItemSelect]\n  );\n\n  const handleScroll = useCallback((e: React.UIEvent<HTMLDivElement>) => {\n    const target = e.target as HTMLDivElement;\n    const { scrollTop, scrollHeight, clientHeight } = target;\n    setTopGradientOpacity(Math.min(scrollTop / 50, 1));\n\n    const bottomDistance = scrollHeight - (scrollTop + clientHeight);\n    setBottomGradientOpacity(\n      scrollHeight <= clientHeight ? 0 : Math.min(bottomDistance / 50, 1)\n    );\n  }, []);\n\n  useEffect(() => {\n    if (!enableArrowNavigation) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"ArrowDown\" || (e.key === \"Tab\" && !e.shiftKey)) {\n        e.preventDefault();\n        setKeyboardNav(true);\n        setSelectedIndex((prev) => Math.min(prev + 1, items.length - 1));\n      } else if (e.key === \"ArrowUp\" || (e.key === \"Tab\" && e.shiftKey)) {\n        e.preventDefault();\n        setKeyboardNav(true);\n        setSelectedIndex((prev) => Math.max(prev - 1, 0));\n      } else if (e.key === \"Enter\") {\n        if (selectedIndex >= 0 && selectedIndex < items.length) {\n          e.preventDefault();\n          if (onItemSelect) {\n            onItemSelect(items[selectedIndex], selectedIndex);\n          }\n        }\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [items, selectedIndex, onItemSelect, enableArrowNavigation]);\n\n  useEffect(() => {\n    if (!keyboardNav || selectedIndex < 0 || !listRef.current) return;\n\n    const container = listRef.current;\n    const selectedItem = container.querySelector(\n      `[data-index=\"${selectedIndex}\"]`\n    ) as HTMLElement;\n\n    if (selectedItem) {\n      const extraMargin = 50;\n      const containerScrollTop = container.scrollTop;\n      const containerHeight = container.clientHeight;\n      const itemTop = selectedItem.offsetTop;\n      const itemBottom = itemTop + selectedItem.offsetHeight;\n\n      if (itemTop < containerScrollTop + extraMargin) {\n        container.scrollTo({\n          top: itemTop - extraMargin,\n          behavior: \"smooth\",\n        });\n      } else if (\n        itemBottom >\n        containerScrollTop + containerHeight - extraMargin\n      ) {\n        container.scrollTo({\n          top: itemBottom - containerHeight + extraMargin,\n          behavior: \"smooth\",\n        });\n      }\n    }\n\n    setKeyboardNav(false);\n  }, [selectedIndex, keyboardNav]);\n\n  return (\n    <div className={`animated-list-container ${className}`}>\n      <div\n        ref={listRef}\n        className={`animated-list ${displayScrollbar ? \"\" : \"no-scrollbar\"}`}\n        onScroll={handleScroll}\n      >\n        {items.map((item, index) => (\n          <AnimatedItem\n            key={index}\n            delay={0.05 * index}\n            index={index}\n            onMouseEnter={() => handleItemMouseEnter(index)}\n            onClick={() => handleItemClick(item, index)}\n          >\n            <div\n              className={`animated-list-item ${itemClassName} ${\n                selectedIndex === index ? \"selected\" : \"\"\n              }`}\n            >\n              {item}\n            </div>\n          </AnimatedItem>\n        ))}\n      </div>\n\n      {showGradients && (\n        <>\n          <div\n            className=\"top-gradient\"\n            style={{ opacity: topGradientOpacity }}\n          />\n          <div\n            className=\"bottom-gradient\"\n            style={{ opacity: bottomGradientOpacity }}\n          />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default AnimatedList;\n"
  },
  {
    "path": "src/components/Grade6StandardsView.tsx",
    "content": "import { useState, ReactNode } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Collapsible, \n  CollapsibleContent, \n  CollapsibleTrigger \n} from \"@/components/ui/collapsible\";\nimport { Standard, SubIndicator } from \"@/data/standards\";\nimport { PlayCircle, ChevronDown, ChevronUp } from \"lucide-react\";\nimport AnimatedList from \"./AnimatedList\";\n\ninterface Grade6StandardsViewProps {\n  standards: Standard[];\n  onStartQuiz: (standardId: string, subIndicatorId?: string) => void;\n}\n\nconst Grade6StandardsView = ({ standards, onStartQuiz }: Grade6StandardsViewProps) => {\n  const [openStandards, setOpenStandards] = useState<Record<string, boolean>>({});\n\n  const toggleStandard = (standardId: string) => {\n    setOpenStandards(prev => ({\n      ...prev,\n      [standardId]: !prev[standardId]\n    }));\n  };\n\n  // فلترة المعايير التي تحتوي على مؤشرات فرعية (الصف السادس: لغتي، رياضيات، علوم | الصف الثالث: رياضيات، لغتي)\n  const filteredStandards = standards.filter(\n    s => (s.id.startsWith('std-r6-') || s.id.startsWith('std-m6-') || s.id.startsWith('std-s6-') || s.id.startsWith('std-m3-') || s.id.startsWith('std-r3-')) && s.subIndicators && s.subIndicators.length > 0\n  );\n\n  if (filteredStandards.length === 0) {\n    return null;\n  }\n\n  // تحويل المعايير إلى عناصر قابلة للعرض\n  const standardItems: ReactNode[] = filteredStandards.map((standard, index) => (\n    <Card \n      key={standard.id} \n      className=\"border border-border bg-card overflow-hidden\"\n    >\n      <Collapsible \n        open={openStandards[standard.id]} \n        onOpenChange={() => toggleStandard(standard.id)}\n      >\n        <CollapsibleTrigger asChild>\n          <CardContent className=\"p-5 cursor-pointer hover:bg-accent/50 transition-colors\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"w-12 h-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-bold shrink-0 text-lg\">\n                {index + 1}\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-xs text-muted-foreground mb-1\">\n                      الكود: {standard.code}\n                    </p>\n                    <h4 className=\"font-bold text-foreground text-lg\">\n                      {standard.name}\n                    </h4>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-muted-foreground\">\n                      {standard.subIndicators?.length} مؤشرات\n                    </span>\n                    {openStandards[standard.id] ? (\n                      <ChevronUp className=\"w-5 h-5 text-muted-foreground\" />\n                    ) : (\n                      <ChevronDown className=\"w-5 h-5 text-muted-foreground\" />\n                    )}\n                  </div>\n                </div>\n                <p className=\"text-sm text-muted-foreground mt-2 line-clamp-2\">\n                  {standard.description}\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </CollapsibleTrigger>\n        \n        <CollapsibleContent>\n          <div className=\"border-t border-border bg-muted/30\">\n            <div className=\"p-4 space-y-3\">\n              <p className=\"text-sm font-medium text-foreground mb-3\">\n                المؤشرات الفرعية:\n              </p>\n              {standard.subIndicators?.map((subIndicator: SubIndicator) => (\n                <div \n                  key={subIndicator.id}\n                  className=\"bg-card rounded-lg p-4 border border-border hover:shadow-sm transition-all\"\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-8 h-8 rounded-full bg-accent text-accent-foreground flex items-center justify-center font-medium shrink-0 text-sm\">\n                      {subIndicator.code}\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm text-foreground leading-relaxed\">\n                        {subIndicator.name}\n                      </p>\n                      <Button \n                        onClick={(e) => {\n                          e.stopPropagation();\n                          onStartQuiz(standard.id, subIndicator.id);\n                        }}\n                        className=\"mt-3 btn-primary-gradient\"\n                        size=\"sm\"\n                      >\n                        <PlayCircle className=\"w-4 h-4 ml-2\" />\n                        ابدأ الاختبار\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </CollapsibleContent>\n      </Collapsible>\n    </Card>\n  ));\n\n  return (\n    <AnimatedList\n      items={standardItems}\n      showGradients={true}\n      enableArrowNavigation={false}\n      displayScrollbar={true}\n      className=\"w-full\"\n    />\n  );\n};\n\nexport default Grade6StandardsView;\n"
  },
  {
    "path": "src/components/GradeCard.tsx",
    "content": "import { Grade } from \"@/data/standards\";\nimport { ShinyButton } from \"@/components/ui/shiny-button\";\nimport threeIcon from \"@/assets/three-icon.png\";\nimport sixIcon from \"@/assets/six-icon.png\";\n\ninterface GradeCardProps {\n  grade: Grade;\n  onClick: () => void;\n}\n\nconst GradeCard = ({ grade, onClick }: GradeCardProps) => {\n  // استخدام أيقونات مخصصة لكل صف\n  const isGrade3 = grade.id === \"grade-3\";\n  const isGrade6 = grade.id === \"grade-6\";\n\n  return (\n    <ShinyButton \n      onClick={onClick}\n      className=\"w-full p-4 md:p-8 text-center bg-card border-2 border-border hover:border-primary rounded-xl\"\n    >\n      <div className=\"flex flex-col items-center\">\n        {isGrade3 ? (\n          <img src={threeIcon} alt=\"الصف الثالث\" className=\"w-14 h-14 md:w-20 md:h-20 mb-2 md:mb-4 rounded-xl\" />\n        ) : isGrade6 ? (\n          <img src={sixIcon} alt=\"الصف السادس\" className=\"w-14 h-14 md:w-20 md:h-20 mb-2 md:mb-4 rounded-xl\" />\n        ) : null}\n        <h3 className=\"text-sm md:text-xl font-bold text-foreground leading-tight\">{grade.name}</h3>\n        <p className=\"text-muted-foreground text-xs md:text-base mt-1 md:mt-2\">اختر للبدء</p>\n      </div>\n    </ShinyButton>\n  );\n};\n\nexport default GradeCard;\n"
  },
  {
    "path": "src/components/Header.tsx",
    "content": "import ThemeToggle from \"./ThemeToggle\";\n\nconst Header = () => {\n  return (\n    <header className=\"bg-background py-3 px-4 border-b border-border\">\n      <div className=\"container mx-auto flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-lg md:text-xl font-bold text-primary\">ابتدائية سعد بن أبي وقاص</h1>\n          <p className=\"text-xs text-muted-foreground\">اختبارات محاكية لاختبارات نافس</p>\n        </div>\n        <ThemeToggle />\n      </div>\n    </header>\n  );\n};\n\nexport default Header;\n"
  },
  {
    "path": "src/components/NavLink.tsx",
    "content": "import { NavLink as RouterNavLink, NavLinkProps } from \"react-router-dom\";\nimport { forwardRef } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface NavLinkCompatProps extends Omit<NavLinkProps, \"className\"> {\n  className?: string;\n  activeClassName?: string;\n  pendingClassName?: string;\n}\n\nconst NavLink = forwardRef<HTMLAnchorElement, NavLinkCompatProps>(\n  ({ className, activeClassName, pendingClassName, to, ...props }, ref) => {\n    return (\n      <RouterNavLink\n        ref={ref}\n        to={to}\n        className={({ isActive, isPending }) =>\n          cn(className, isActive && activeClassName, isPending && pendingClassName)\n        }\n        {...props}\n      />\n    );\n  },\n);\n\nNavLink.displayName = \"NavLink\";\n\nexport { NavLink };\n"
  },
  {
    "path": "src/components/ParentLogin.tsx",
    "content": "import { useState, useEffect } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { User, Users, ArrowRight, Lock, Loader2 } from \"lucide-react\";\nimport {\n  InputOTP,\n  InputOTPGroup,\n  InputOTPSlot,\n} from \"@/components/ui/input-otp\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\ninterface Student {\n  id: string;\n  student_name: string;\n  pin_code: string;\n}\n\ninterface ParentLoginProps {\n  grade: string;\n  gradeName: string;\n  onBack: () => void;\n  onSuccess: (studentName: string) => void;\n}\n\nconst ParentLogin = ({ grade, gradeName, onBack, onSuccess }: ParentLoginProps) => {\n  const [students, setStudents] = useState<Student[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedStudent, setSelectedStudent] = useState<Student | null>(null);\n  const [pin, setPin] = useState(\"\");\n  const [error, setError] = useState(\"\");\n\n  useEffect(() => {\n    const fetchStudents = async () => {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from(\"students\")\n        .select(\"id, student_name, pin_code\")\n        .eq(\"grade\", grade)\n        .order(\"student_name\");\n\n      if (error) {\n        console.error(\"Error fetching students:\", error);\n      } else {\n        setStudents(data || []);\n      }\n      setLoading(false);\n    };\n\n    fetchStudents();\n  }, [grade]);\n\n  const handlePinComplete = (value: string) => {\n    setPin(value);\n    if (value.length === 4 && selectedStudent) {\n      if (value === selectedStudent.pin_code) {\n        setError(\"\");\n        onSuccess(selectedStudent.student_name);\n      } else {\n        setError(\"الرمز غير صحيح - أدخل آخر 4 أرقام من جوال ولي الأمر\");\n        setPin(\"\");\n      }\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[300px]\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  // اختيار الطالب\n  if (!selectedStudent) {\n    return (\n      <div className=\"animate-fade-in\">\n        <div className=\"text-center mb-8\">\n          <div className=\"bg-secondary/20 rounded-full p-4 w-20 h-20 mx-auto mb-4 flex items-center justify-center\">\n            <Users className=\"w-10 h-10 text-secondary\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-foreground mb-2\">دخول ولي الأمر</h2>\n          <p className=\"text-muted-foreground\">{gradeName} - اختر اسم الطالب</p>\n        </div>\n\n        <div className=\"max-w-2xl mx-auto\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onBack}\n            className=\"mb-4 text-muted-foreground hover:text-foreground\"\n          >\n            <ArrowRight className=\"w-4 h-4 ml-1\" />\n            رجوع\n          </Button>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n            {students.map((student) => (\n              <Card\n                key={student.id}\n                className=\"cursor-pointer card-hover border-2 border-border hover:border-secondary bg-card\"\n                onClick={() => setSelectedStudent(student)}\n              >\n                <CardContent className=\"p-4 flex items-center gap-3\">\n                  <div className=\"bg-primary/10 rounded-full p-2\">\n                    <User className=\"w-5 h-5 text-primary\" />\n                  </div>\n                  <span className=\"font-medium text-foreground\">{student.student_name}</span>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // إدخال رمز PIN\n  return (\n    <div className=\"animate-fade-in\">\n      <div className=\"text-center mb-8\">\n        <div className=\"bg-secondary/20 rounded-full p-4 w-20 h-20 mx-auto mb-4 flex items-center justify-center\">\n          <Lock className=\"w-10 h-10 text-secondary\" />\n        </div>\n        <h2 className=\"text-2xl font-bold text-foreground mb-2\">أدخل رمز ولي الأمر</h2>\n        <p className=\"text-muted-foreground\">الطالب: {selectedStudent.student_name}</p>\n      </div>\n\n      <div className=\"max-w-md mx-auto\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => {\n            setSelectedStudent(null);\n            setPin(\"\");\n            setError(\"\");\n          }}\n          className=\"mb-4 text-muted-foreground hover:text-foreground\"\n        >\n          <ArrowRight className=\"w-4 h-4 ml-1\" />\n          اختر طالب آخر\n        </Button>\n\n        <Card className=\"border-2 border-border bg-card\">\n          <CardContent className=\"p-8 flex flex-col items-center\">\n            <p className=\"text-muted-foreground mb-6\">أدخل آخر 4 أرقام من جوال ولي الأمر</p>\n            \n            <div dir=\"ltr\">\n              <InputOTP\n                maxLength={4}\n                value={pin}\n                onChange={handlePinComplete}\n              >\n                <InputOTPGroup>\n                  <InputOTPSlot index={0} />\n                  <InputOTPSlot index={1} />\n                  <InputOTPSlot index={2} />\n                  <InputOTPSlot index={3} />\n                </InputOTPGroup>\n              </InputOTP>\n            </div>\n\n            {error && (\n              <p className=\"text-destructive mt-4 text-sm\">{error}</p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default ParentLogin;\n"
  },
  {
    "path": "src/components/SpinWheel.tsx",
    "content": "import { useRef, useState, useEffect } from \"react\";\n\ninterface SpinWheelProps {\n  students: string[];\n  onSelect: (student: string) => void;\n  isSpinning: boolean;\n  setIsSpinning: (spinning: boolean) => void;\n}\n\nconst SpinWheel = ({ students, onSelect, isSpinning, setIsSpinning }: SpinWheelProps) => {\n  const [rotation, setRotation] = useState(0);\n  const wheelRef = useRef<HTMLDivElement>(null);\n  \n  const colors = [\n    \"hsl(var(--primary))\",\n    \"hsl(var(--secondary))\",\n    \"hsl(210, 60%, 50%)\",\n    \"hsl(150, 60%, 45%)\",\n    \"hsl(45, 80%, 50%)\",\n    \"hsl(280, 60%, 50%)\",\n    \"hsl(0, 60%, 50%)\",\n    \"hsl(180, 60%, 45%)\",\n  ];\n\n  const segmentAngle = 360 / students.length;\n\n  const spin = () => {\n    if (isSpinning) return;\n    \n    setIsSpinning(true);\n    \n    // Random number of full rotations (5-10) plus random position\n    const fullRotations = Math.floor(Math.random() * 6) + 5;\n    const randomAngle = Math.random() * 360;\n    const newRotation = rotation + (fullRotations * 360) + randomAngle;\n    \n    setRotation(newRotation);\n    \n    // Calculate which student is selected after spin\n    setTimeout(() => {\n      // السهم يشير للأعلى (عند زاوية -90 درجة من منظور الدائرة)\n      // القطاع 0 يبدأ عند -90 درجة ويمتد في اتجاه عقارب الساعة\n      // عند دوران العجلة بزاوية R، نحتاج معرفة أي قطاع يكون تحت السهم\n      \n      // تطبيع زاوية الدوران للحصول على زاوية بين 0-360\n      const normalizedRotation = ((newRotation % 360) + 360) % 360;\n      \n      // عندما تدور العجلة في اتجاه عقارب الساعة، القطاعات تتحرك بعكس الترتيب\n      // نحسب كم قطاع تحركت العجلة من موضعها الأصلي\n      const selectedIndex = Math.floor((360 - normalizedRotation + segmentAngle / 2) / segmentAngle) % students.length;\n      \n      onSelect(students[selectedIndex]);\n    }, 4000);\n  };\n\n  return (\n    <div className=\"relative w-80 h-80 md:w-96 md:h-96\">\n      {/* Pointer */}\n      <div className=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-2 z-10\">\n        <div className=\"w-0 h-0 border-l-[15px] border-r-[15px] border-t-[30px] border-l-transparent border-r-transparent border-t-primary drop-shadow-lg\" />\n      </div>\n      \n      {/* Wheel */}\n      <div\n        ref={wheelRef}\n        className=\"w-full h-full rounded-full overflow-hidden cursor-pointer shadow-2xl border-4 border-border\"\n        style={{\n          transform: `rotate(${rotation}deg)`,\n          transition: isSpinning ? \"transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)\" : \"none\",\n        }}\n        onClick={spin}\n      >\n        <svg viewBox=\"0 0 100 100\" className=\"w-full h-full\">\n          {students.map((student, index) => {\n            const startAngle = index * segmentAngle - 90;\n            const endAngle = startAngle + segmentAngle;\n            \n            const startRad = (startAngle * Math.PI) / 180;\n            const endRad = (endAngle * Math.PI) / 180;\n            \n            const x1 = 50 + 50 * Math.cos(startRad);\n            const y1 = 50 + 50 * Math.sin(startRad);\n            const x2 = 50 + 50 * Math.cos(endRad);\n            const y2 = 50 + 50 * Math.sin(endRad);\n            \n            const largeArcFlag = segmentAngle > 180 ? 1 : 0;\n            \n            const pathData = `M 50 50 L ${x1} ${y1} A 50 50 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;\n            \n            // Text position\n            const midAngle = ((startAngle + endAngle) / 2) * Math.PI / 180;\n            const textRadius = 30;\n            const textX = 50 + textRadius * Math.cos(midAngle);\n            const textY = 50 + textRadius * Math.sin(midAngle);\n            const textRotation = (startAngle + endAngle) / 2 + 90;\n            \n            // Get first name only for display\n            const displayName = student.split(\" \")[0];\n            \n            return (\n              <g key={index}>\n                <path\n                  d={pathData}\n                  fill={colors[index % colors.length]}\n                  stroke=\"hsl(var(--background))\"\n                  strokeWidth=\"0.5\"\n                />\n                <text\n                  x={textX}\n                  y={textY}\n                  fill=\"white\"\n                  fontSize=\"3\"\n                  fontWeight=\"bold\"\n                  textAnchor=\"middle\"\n                  dominantBaseline=\"middle\"\n                  transform={`rotate(${textRotation}, ${textX}, ${textY})`}\n                  style={{ textShadow: \"0 1px 2px rgba(0,0,0,0.5)\" }}\n                >\n                  {displayName}\n                </text>\n              </g>\n            );\n          })}\n          {/* Center circle */}\n          <circle cx=\"50\" cy=\"50\" r=\"8\" fill=\"hsl(var(--background))\" stroke=\"hsl(var(--border))\" strokeWidth=\"1\" />\n          <text x=\"50\" y=\"50\" fill=\"hsl(var(--foreground))\" fontSize=\"3\" textAnchor=\"middle\" dominantBaseline=\"middle\" fontWeight=\"bold\">\n            دوران\n          </text>\n        </svg>\n      </div>\n      \n      {!isSpinning && (\n        <p className=\"text-center text-muted-foreground mt-4 text-sm\">اضغط على العجلة للدوران</p>\n      )}\n    </div>\n  );\n};\n\nexport default SpinWheel;\n"
  },
  {
    "path": "src/components/Stack.tsx",
    "content": "import { useState, useEffect, useCallback, ReactNode } from \"react\";\nimport { motion, useMotionValue, useTransform } from \"motion/react\";\n\ninterface StackProps {\n  cards?: ReactNode[];\n  randomRotation?: boolean;\n  sensitivity?: number;\n  sendToBackOnClick?: boolean;\n  autoplay?: boolean;\n  autoplayDelay?: number;\n  pauseOnHover?: boolean;\n  animationConfig?: {\n    stiffness?: number;\n    damping?: number;\n  };\n}\n\nconst Stack = ({\n  cards = [],\n  randomRotation = true,\n  sensitivity = 200,\n  sendToBackOnClick = false,\n  autoplay = false,\n  autoplayDelay = 3000,\n  pauseOnHover = false,\n  animationConfig = { stiffness: 260, damping: 20 },\n}: StackProps) => {\n  const [stack, setStack] = useState<number[]>(cards.map((_, i) => i));\n  const [isPaused, setIsPaused] = useState(false);\n\n  const sendToBack = useCallback((id: number) => {\n    setStack((prev) => {\n      const newStack = prev.filter((i) => i !== id);\n      newStack.unshift(id);\n      return newStack;\n    });\n  }, []);\n\n  useEffect(() => {\n    if (!autoplay || isPaused || cards.length === 0) return;\n    const id = setInterval(() => {\n      const topCard = stack[stack.length - 1];\n      sendToBack(topCard);\n    }, autoplayDelay);\n    return () => clearInterval(id);\n  }, [autoplay, isPaused, cards.length, autoplayDelay, stack, sendToBack]);\n\n  const handleMouseEnter = () => {\n    if (pauseOnHover) setIsPaused(true);\n  };\n\n  const handleMouseLeave = () => {\n    if (pauseOnHover) setIsPaused(false);\n  };\n\n  return (\n    <div\n      className=\"relative w-60 h-60 md:w-80 md:h-80\"\n      style={{ perspective: 600 }}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n    >\n      {stack.map((cardIndex, i) => {\n        const isTop = i === stack.length - 1;\n        const randomDeg = randomRotation\n          ? Math.random() * 10 - 5\n          : 0;\n\n        return (\n          <CardWrapper\n            key={cardIndex}\n            isTop={isTop}\n            sendToBack={() => sendToBack(cardIndex)}\n            sensitivity={sensitivity}\n            sendToBackOnClick={sendToBackOnClick}\n            animationConfig={animationConfig}\n            zIndex={i}\n            randomDeg={randomDeg}\n          >\n            {cards[cardIndex]}\n          </CardWrapper>\n        );\n      })}\n    </div>\n  );\n};\n\ninterface CardWrapperProps {\n  children: ReactNode;\n  isTop: boolean;\n  sendToBack: () => void;\n  sensitivity: number;\n  sendToBackOnClick: boolean;\n  animationConfig: {\n    stiffness?: number;\n    damping?: number;\n  };\n  zIndex: number;\n  randomDeg: number;\n}\n\nconst CardWrapper = ({\n  children,\n  isTop,\n  sendToBack,\n  sensitivity,\n  sendToBackOnClick,\n  animationConfig,\n  zIndex,\n  randomDeg,\n}: CardWrapperProps) => {\n  const x = useMotionValue(0);\n  const y = useMotionValue(0);\n  const rotateX = useTransform(y, [-100, 100], [10, -10]);\n  const rotateY = useTransform(x, [-100, 100], [-10, 10]);\n\n  const handleDragEnd = (_: unknown, info: { offset: { x: number; y: number } }) => {\n    if (\n      Math.abs(info.offset.x) > sensitivity ||\n      Math.abs(info.offset.y) > sensitivity\n    ) {\n      sendToBack();\n    }\n  };\n\n  return (\n    <motion.div\n      className=\"absolute w-full h-full cursor-grab active:cursor-grabbing rounded-xl overflow-hidden shadow-lg\"\n      style={{\n        x,\n        y,\n        rotateX,\n        rotateY,\n        rotate: `${randomDeg}deg`,\n        zIndex,\n      }}\n      drag={isTop}\n      dragConstraints={{ top: 0, bottom: 0, left: 0, right: 0 }}\n      dragElastic={0.6}\n      onDragEnd={handleDragEnd}\n      onClick={sendToBackOnClick && isTop ? sendToBack : undefined}\n      whileTap={isTop ? { scale: 1.02 } : undefined}\n      transition={{\n        type: \"spring\",\n        stiffness: animationConfig.stiffness,\n        damping: animationConfig.damping,\n      }}\n    >\n      {children}\n    </motion.div>\n  );\n};\n\nexport default Stack;\n"
  }
]